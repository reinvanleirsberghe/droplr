function showErrors(a){$(".alert-ajax").show(),$.each(a,function(a,n){$(".alert-ajax").find("ul").append("<li>"+n+"</li>")})}
function drawRoute(){var a=0,e=-1;map.removePolylines();var r=$("#drop_list li");r.each(function(r,t){var o=$(t).data("marker-index");if(-1!==e){var n=map.markers[o].getPosition(),s=n.lat(),l=n.lng(),i=map.markers[e].getPosition(),c=i.lat(),d=i.lng(),m=new google.maps.LatLng(s,l),p=new google.maps.LatLng(c,d);map.drawPolyline({path:[m,p],strokeColor:"##FF0000",strokeOpacity:1,strokeWeight:2}),a+=google.maps.geometry.spherical.computeDistanceBetween(m,p)}e=o}),$("#drop_list li").mouseenter(function(){var a=$(this).data("marker-index"),e=map.markers[a];e.setIcon(iconHover)}).mouseleave(function(){var a=$(this).data("marker-index"),e=map.markers[a];e.setIcon(iconDefault)})}function listMarkers(a,e,r,t,o){dropList.append('<li id="marker-id-'+t+'" class="marker-list-item'+a+'" data-marker-index="'+a+'"><a href="javascript:;" class="marker-list-a" data-marker-id="'+t+'">'+o+'</a><i class="fa fa-sort pull-right"></i><a href="#" class="delete-marker" data-marker-id="'+t+'" data-marker-index="'+a+'"><i class="glyphicon glyphicon-remove pull-right"></i><a href="#" class="goto-marker" data-marker-lat="'+e+'" data-marker-lng="'+r+'" data-marker-index="'+a+'"><i class="fa fa-eye pull-right"></i></a></li>'),dropList.sortable({axis:"y",update:function(){loader.show();var a=$(this).sortable("serialize");$.ajax({type:"POST",url:"/drops/sortmarkers/"+Boilerplate.currentDropId,processData:!1,cache:!1,dataType:"json",data:a,success:function(a){a.success&&(loader.hide(),drawRoute())},error:function(a){console.log(a)}})}}),markersAmount.val($("#drop_list li").length),$(".marker-list-a").click(function(){var a=$(this).data("marker-id");showMarker(a)})}function addMarker(a,e,r,t){var o=map.addMarker({lat:e,lng:r,draggable:!0,icon:iconDefault,title:"Marker #"+a});o.set("id",t),GMaps.on("click",o,function(){showMarker(o.id)}),GMaps.on("dragend",o,function(a){loader.show();var e=o.id,r=new FormData;r.append("lat",a.latLng.lat()),r.append("lng",a.latLng.lng()),$.ajax({method:"POST",url:"/marker/updatelatlng/"+e,processData:!1,contentType:!1,cache:!1,dataType:"json",data:r,success:function(a){1==a.success&&(loader.hide(),drawRoute())},error:function(a){console.log("Marker could not be updated:"+a)}})}),drawRoute()}function showMarker(a){$.ajax({type:"GET",url:"/marker/show/"+a,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(a){a.success&&($("#modalMarker .modal-body").html(a.view),eventContent=$("#event-content"),$("#event").change(function(){$(this).prop("checked")?eventContent.show():eventContent.hide()}),$("#modalMarker").modal("show"))},error:function(a){console.log("Marker could not be shown: "+a)}})}$(document).ready(function(){dropList=$("#drop_list"),markersAmount=$("#markers_amount"),iconDefault="http://maps.google.com/mapfiles/ms/icons/red-dot.png",iconHover="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",loader=$(".map_loader"),map=new GMaps({div:"#drop_map",zoom:15,lat:51.1285327,lng:3.304863100000034});var a=Boilerplate.currenDropMarkers;a&&$(a).each(function(){var a=map.markers.length,e=$(this)[0].lat,r=$(this)[0].lng,t=$(this)[0].id;listMarkers(a,e,r,$(this)[0].id,$(this)[0].name),addMarker(a,e,r,t)}),GMaps.on("click",map.map,function(a){loader.show();var e=map.markers.length,r=a.latLng.lat(),t=a.latLng.lng(),o=new FormData;o.append("name","Marker "+(e+1)),o.append("lat",r),o.append("lng",t),o.append("dropId",Boilerplate.currentDropId),$.ajax({type:"POST",url:"/marker/add",processData:!1,contentType:!1,cache:!1,dataType:"json",data:o,success:function(a){a.success&&(loader.hide(),addMarker(e,r,t,a.marker.id),listMarkers(e,r,t,a.marker.id,a.marker.name),drawRoute())},error:function(a){console.log("Marker could not be created: "+a)}})}),$(document).on("click",".goto-marker",function(a){a.preventDefault();var e,r,t=$(this).data("marker-index"),o=map.markers[t].getPosition();e=o.lat(),r=o.lng(),map.setCenter(e,r)}),$(document).on("click",".delete-marker",function(a){loader.show(),a.preventDefault();var e=$(this).data("marker-id"),r=$(this).data("marker-index"),t=map.markers[r];$.ajax({type:"DELETE",url:"/marker/delete/"+e,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(a){a.success&&(loader.hide(),t.setMap(null),$(".marker-list-item"+r).remove(),markersAmount.val($("#drop_list li").length),drawRoute())},error:function(a){console.log("Marker could not be removed: "+a)}})}),$("#marker-submit").click(function(){var a=$("#current_marker").val(),e=0;$("#event").prop("checked")&&(e=1);var r=new FormData;r.append("name",$("#name").val()),r.append("hasEvent",e),$.ajax({method:"POST",url:"/marker/updateinfo/"+a,processData:!1,contentType:!1,cache:!1,dataType:"json",data:r,success:function(e){console.log(e),e.success?($("#marker-id-"+a+" .marker-list-a").html(e.marker.name),$(".alert-ajax").hide().find("ul").empty(),$("#modalMarker").modal("hide")):showErrors(e.errors)},error:function(a){console.log("Marker could not be updated the info:"+a)}})})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJEcm9wL2VkaXQuanMiXSwibmFtZXMiOlsic2hvd0Vycm9ycyIsImVycm9ycyIsIiQiLCJzaG93IiwiZWFjaCIsImluZGV4IiwiZXJyb3IiLCJmaW5kIiwiYXBwZW5kIiwiZHJhd1JvdXRlIiwiZGlzdGFuY2UiLCJsYXN0SW5kZXgiLCJtYXAiLCJyZW1vdmVQb2x5bGluZXMiLCJkcm9wTGlzdCIsImlkeCIsImxpIiwiJGluZGV4IiwiZGF0YSIsImN1cnJlbnRQb3NpdGlvbiIsIm1hcmtlcnMiLCJnZXRQb3NpdGlvbiIsImN1cnJlbnRMYXQiLCJsYXQiLCJjdXJyZW50TG5nIiwibG5nIiwibGFzdFBvc2l0aW9uIiwibGFzdExhdCIsImxhc3RMbmciLCJjdXJyZW50TGF0bG5nIiwiZ29vZ2xlIiwibWFwcyIsIkxhdExuZyIsImxhc3RMYXRsbmciLCJkcmF3UG9seWxpbmUiLCJwYXRoIiwic3Ryb2tlQ29sb3IiLCJzdHJva2VPcGFjaXR5Iiwic3Ryb2tlV2VpZ2h0IiwiZ2VvbWV0cnkiLCJzcGhlcmljYWwiLCJjb21wdXRlRGlzdGFuY2VCZXR3ZWVuIiwibW91c2VlbnRlciIsInRoaXMiLCJtYXJrZXIiLCJzZXRJY29uIiwiaWNvbkhvdmVyIiwibW91c2VsZWF2ZSIsImljb25EZWZhdWx0IiwibGlzdE1hcmtlcnMiLCJpZCIsIm5hbWUiLCJzb3J0YWJsZSIsImF4aXMiLCJ1cGRhdGUiLCJsb2FkZXIiLCJmb3JtRGF0YSIsImFqYXgiLCJ0eXBlIiwidXJsIiwiQm9pbGVycGxhdGUiLCJjdXJyZW50RHJvcElkIiwicHJvY2Vzc0RhdGEiLCJjYWNoZSIsImRhdGFUeXBlIiwic3VjY2VzcyIsImhpZGUiLCJjb25zb2xlIiwibG9nIiwibWFya2Vyc0Ftb3VudCIsInZhbCIsImxlbmd0aCIsImNsaWNrIiwic2hvd01hcmtlciIsImFkZE1hcmtlciIsImRyYWdnYWJsZSIsImljb24iLCJ0aXRsZSIsInNldCIsIkdNYXBzIiwib24iLCJlIiwibWFya2VySWQiLCJGb3JtRGF0YSIsImxhdExuZyIsIm1ldGhvZCIsImNvbnRlbnRUeXBlIiwiaHRtbCIsInZpZXciLCJldmVudENvbnRlbnQiLCJjaGFuZ2UiLCJwcm9wIiwibW9kYWwiLCJkb2N1bWVudCIsInJlYWR5IiwiZGl2Iiwiem9vbSIsImN1cnJlbkRyb3BNYXJrZXJzIiwibWFya2VySW5kZXgiLCJtYXJrZXJMYXQiLCJtYXJrZXJMbmciLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwicG9zaXRpb24iLCJzZXRDZW50ZXIiLCJzZXRNYXAiLCJyZW1vdmUiLCJtYXJrZXJIYXNFdmVudCIsImVtcHR5Il0sIm1hcHBpbmdzIjoiQUFBQSxRQUFTQSxZQUFXQyxHQUVoQkMsRUFBRSxlQUFlQyxPQUNqQkQsRUFBRUUsS0FBS0gsRUFBUSxTQUFTSSxFQUFPQyxHQUMzQkosRUFBRSxlQUFlSyxLQUFLLE1BQU1DLE9BQU8sT0FBU0YsRUFBUTtBQ3lLNUQsUUFBU0csYUFDTCxHQUFJQyxHQUFXLEVBQ1hDLEVBQVksRUFFaEJDLEtBQUlDLGlCQUVKLElBQUlDLEdBQVdaLEVBQUUsZ0JBQ2pCWSxHQUFTVixLQUFLLFNBQVVXLEVBQUtDLEdBRXpCLEdBQUlDLEdBQVVmLEVBQUVjLEdBQUlFLEtBQUssZUFFekIsSUFBa0IsS0FBZFAsRUFBa0IsQ0FDbEIsR0FBSVEsR0FBa0JQLElBQUlRLFFBQVFILEdBQVFJLGNBQ3RDQyxFQUFhSCxFQUFnQkksTUFDN0JDLEVBQWFMLEVBQWdCTSxNQUU3QkMsRUFBZWQsSUFBSVEsUUFBUVQsR0FBV1UsY0FDdENNLEVBQVVELEVBQWFILE1BQ3ZCSyxFQUFVRixFQUFhRCxNQUV2QkksRUFBZ0IsR0FBSUMsUUFBT0MsS0FBS0MsT0FBT1YsRUFBWUUsR0FDbkRTLEVBQWEsR0FBSUgsUUFBT0MsS0FBS0MsT0FBT0wsRUFBU0MsRUFFakRoQixLQUFJc0IsY0FDQUMsTUFBT04sRUFBZUksR0FDdEJHLFlBQWEsV0FDYkMsY0FBZSxFQUNmQyxhQUFjLElBR2xCNUIsR0FBWW9CLE9BQU9DLEtBQUtR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QUFVeUYsS0FBSyxhQUFZZ0IsRUFBaUIsRUFHakQsSUFBSW5ELEdBQVcsR0FBSTJCLFNBQ25CM0IsR0FBU2hELE9BQU8sT0FBUU4sRUFBRSxTQUFTb0UsT0FDbkNkLEVBQVNoRCxPQUFPLFdBQVltRyxHQUU1QnpHLEVBQUV1RCxNQUNFNEIsT0FBUSxPQUNSMUIsSUFBSyxzQkFBd0J1QixFQUM3QnBCLGFBQWEsRUFDYndCLGFBQWEsRUFDYnZCLE9BQU8sRUFDUEMsU0FBVSxPQUNWOUMsS0FBTXNDLEVBQ05TLFFBQVMsU0FBVS9DLEdBQ2ZpRCxRQUFRQyxJQUFJbEQsR0FHUkEsRUFBSytDLFNBRUwvRCxFQUFFLGNBQWdCZ0YsRUFBVyxtQkFBbUJLLEtBQUtyRSxFQUFLMEIsT0FBT08sTUFHakVqRCxFQUFFLGVBQWVnRSxPQUFPM0QsS0FBSyxNQUFNcUcsUUFHbkMxRyxFQUFFLGdCQUFnQjBGLE1BQU0sU0FJeEI1RixXQUFXa0IsRUFBS2pCLFNBR3hCSyxNQUFPLFNBQVVZLEdBQ2JpRCxRQUFRQyxJQUFJLHdDQUEwQ2xEIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBzaG93RXJyb3JzKGVycm9ycyl7XG4gICAgLy8gc2hvdyBlcnJvcnMgaW4gYWxlcnQtYWpheFxuICAgICQoJy5hbGVydC1hamF4Jykuc2hvdygpO1xuICAgICQuZWFjaChlcnJvcnMsIGZ1bmN0aW9uKGluZGV4LCBlcnJvcil7XG4gICAgICAgICQoJy5hbGVydC1hamF4JykuZmluZCgndWwnKS5hcHBlbmQoJzxsaT4nICsgZXJyb3IgKyAnPC9saT4nKTtcbiAgICB9KTtcbn0iLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgZHJvcExpc3QgPSAkKCcjZHJvcF9saXN0Jyk7XG4gICAgbWFya2Vyc0Ftb3VudCA9ICQoJyNtYXJrZXJzX2Ftb3VudCcpO1xuICAgIGljb25EZWZhdWx0ID0gJ2h0dHA6Ly9tYXBzLmdvb2dsZS5jb20vbWFwZmlsZXMvbXMvaWNvbnMvcmVkLWRvdC5wbmcnO1xuICAgIGljb25Ib3ZlciA9ICdodHRwOi8vbWFwcy5nb29nbGUuY29tL21hcGZpbGVzL21zL2ljb25zL2JsdWUtZG90LnBuZyc7XG4gICAgbG9hZGVyID0gJCgnLm1hcF9sb2FkZXInKTtcblxuICAgIC8vIGluaXQgbWFwXG4gICAgbWFwID0gbmV3IEdNYXBzKHtcbiAgICAgICAgZGl2OiAnI2Ryb3BfbWFwJyxcbiAgICAgICAgem9vbTogMTUsXG4gICAgICAgIGxhdDogNTEuMTI4NTMyNyxcbiAgICAgICAgbG5nOiAzLjMwNDg2MzEwMDAwMDAzNFxuICAgIH0pO1xuXG4gICAgLy8gaWYgdGhlcmUgYXJlIG1hcmtlcnMgZm91bmRcbiAgICB2YXIgbWFya2VycyA9IEJvaWxlcnBsYXRlLmN1cnJlbkRyb3BNYXJrZXJzO1xuICAgIGlmIChtYXJrZXJzKSB7XG4gICAgICAgICQobWFya2VycykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbWFya2VySW5kZXggPSBtYXAubWFya2Vycy5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgbWFya2VyTGF0ID0gJCh0aGlzKVswXS5sYXQ7XG4gICAgICAgICAgICB2YXIgbWFya2VyTG5nID0gJCh0aGlzKVswXS5sbmc7XG4gICAgICAgICAgICB2YXIgbWFya2VySWQgPSAkKHRoaXMpWzBdLmlkO1xuXG4gICAgICAgICAgICBsaXN0TWFya2VycyhtYXJrZXJJbmRleCwgbWFya2VyTGF0LCBtYXJrZXJMbmcsICQodGhpcylbMF0uaWQsICQodGhpcylbMF0ubmFtZSk7XG4gICAgICAgICAgICBhZGRNYXJrZXIobWFya2VySW5kZXgsIG1hcmtlckxhdCwgbWFya2VyTG5nLCBtYXJrZXJJZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGFkZCBhIG1hcmtlclxuICAgIEdNYXBzLm9uKCdjbGljaycsIG1hcC5tYXAsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBsb2FkZXIuc2hvdygpO1xuICAgICAgICB2YXIgbWFya2VySW5kZXggPSBtYXAubWFya2Vycy5sZW5ndGg7XG4gICAgICAgIHZhciBtYXJrZXJMYXQgPSBldmVudC5sYXRMbmcubGF0KCk7XG4gICAgICAgIHZhciBtYXJrZXJMbmcgPSBldmVudC5sYXRMbmcubG5nKCk7XG5cbiAgICAgICAgLy8gcHVzaCBtYXJrZXIgdG8gZGF0YWJhc2VcbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbmFtZScsICdNYXJrZXIgJyArIChtYXJrZXJJbmRleCArIDEpKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdsYXQnLCBtYXJrZXJMYXQpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2xuZycsIG1hcmtlckxuZyk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZHJvcElkJywgQm9pbGVycGxhdGUuY3VycmVudERyb3BJZCk7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgdXJsOiBcIi9tYXJrZXIvYWRkXCIsXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpXG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlci5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYWRkTWFya2VyKG1hcmtlckluZGV4LCBtYXJrZXJMYXQsIG1hcmtlckxuZywgZGF0YS5tYXJrZXIuaWQpO1xuICAgICAgICAgICAgICAgICAgICBsaXN0TWFya2VycyhtYXJrZXJJbmRleCwgbWFya2VyTGF0LCBtYXJrZXJMbmcsIGRhdGEubWFya2VyLmlkLCBkYXRhLm1hcmtlci5uYW1lKTtcblxuICAgICAgICAgICAgICAgICAgICBkcmF3Um91dGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJNYXJrZXIgY291bGQgbm90IGJlIGNyZWF0ZWQ6IFwiICsgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gd2hlbiBjbGlja2luZyBvbiB0aGUgbWFya2VyXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5nb3RvLW1hcmtlcicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgbWFya2VyTGF0LCBtYXJrZXJMbmc7XG5cbiAgICAgICAgdmFyICRpbmRleCA9ICQodGhpcykuZGF0YSgnbWFya2VyLWluZGV4Jyk7XG4gICAgICAgIHZhciBwb3NpdGlvbiA9IG1hcC5tYXJrZXJzWyRpbmRleF0uZ2V0UG9zaXRpb24oKTtcblxuICAgICAgICBtYXJrZXJMYXQgPSBwb3NpdGlvbi5sYXQoKTtcbiAgICAgICAgbWFya2VyTG5nID0gcG9zaXRpb24ubG5nKCk7XG5cbiAgICAgICAgbWFwLnNldENlbnRlcihtYXJrZXJMYXQsIG1hcmtlckxuZyk7XG4gICAgfSk7XG5cbiAgICAvLyB3aGVuIGRlbGV0aW5nIGEgbWFya2VyXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5kZWxldGUtbWFya2VyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgbG9hZGVyLnNob3coKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciBpZCA9ICQodGhpcykuZGF0YSgnbWFya2VyLWlkJyk7XG4gICAgICAgIHZhciAkaW5kZXggPSAkKHRoaXMpLmRhdGEoJ21hcmtlci1pbmRleCcpO1xuICAgICAgICB2YXIgbWFya2VyID0gbWFwLm1hcmtlcnNbJGluZGV4XTtcblxuICAgICAgICAvLyBkZWxldGUgbWFya2VyIGZyb20gZGF0YWJhc2VcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICB1cmw6IFwiL21hcmtlci9kZWxldGUvXCIgKyBpZCxcbiAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSxcbiAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBtYXBcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBsaXN0XG4gICAgICAgICAgICAgICAgICAgICQoJy5tYXJrZXItbGlzdC1pdGVtJyArICRpbmRleCkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGFtb3VudCBvZiBtYXJrZXJzXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcnNBbW91bnQudmFsKCQoJyNkcm9wX2xpc3QgbGknKS5sZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyYXcgcm91dGVcbiAgICAgICAgICAgICAgICAgICAgZHJhd1JvdXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWFya2VyIGNvdWxkIG5vdCBiZSByZW1vdmVkOiBcIiArIGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIHdoZW4gdXBkYXRpbmcgbWFya2VycyBpbmZvXG4gICAgJCgnI21hcmtlci1zdWJtaXQnKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbWFya2VySWQgPSAkKCcjY3VycmVudF9tYXJrZXInKS52YWwoKTtcblxuICAgICAgICB2YXIgbWFya2VySGFzRXZlbnQgPSAwO1xuICAgICAgICBpZigkKCcjZXZlbnQnKS5wcm9wKCdjaGVja2VkJykpIG1hcmtlckhhc0V2ZW50ID0gMTtcblxuICAgICAgICAvLyB1cGRhdGUgbWFya2VyIGluIGRhdGFiYXNlXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCAkKCcjbmFtZScpLnZhbCgpKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdoYXNFdmVudCcsIG1hcmtlckhhc0V2ZW50KTtcblxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIHVybDogXCIvbWFya2VyL3VwZGF0ZWluZm8vXCIgKyBtYXJrZXJJZCxcbiAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSxcbiAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBkYXRhOiBmb3JtRGF0YSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSlcblxuICAgICAgICAgICAgICAgIC8vIGZvcm0gaXMgdmFsaWRcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB2aWV3XG4gICAgICAgICAgICAgICAgICAgICQoJyNtYXJrZXItaWQtJyArIG1hcmtlcklkICsgJyAubWFya2VyLWxpc3QtYScpLmh0bWwoZGF0YS5tYXJrZXIubmFtZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBlcnJvcnNcbiAgICAgICAgICAgICAgICAgICAgJCgnLmFsZXJ0LWFqYXgnKS5oaWRlKCkuZmluZCgndWwnKS5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgbW9kYWxcbiAgICAgICAgICAgICAgICAgICAgJCgnI21vZGFsTWFya2VyJykubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gZm9ybSBpcyBpbnZhbGlkXG4gICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9ycyhkYXRhLmVycm9ycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWFya2VyIGNvdWxkIG5vdCBiZSB1cGRhdGVkIHRoZSBpbmZvOlwiICsgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbi8qKlxuICogRHJhdyB0aGUgcm91dGUgb24gdGhlIG1hcFxuICovXG5mdW5jdGlvbiBkcmF3Um91dGUoKSB7XG4gICAgdmFyIGRpc3RhbmNlID0gMDtcbiAgICB2YXIgbGFzdEluZGV4ID0gLTE7XG5cbiAgICBtYXAucmVtb3ZlUG9seWxpbmVzKCk7XG5cbiAgICB2YXIgZHJvcExpc3QgPSAkKFwiI2Ryb3BfbGlzdCBsaVwiKTtcbiAgICBkcm9wTGlzdC5lYWNoKGZ1bmN0aW9uIChpZHgsIGxpKSB7XG4gICAgICAgIC8vIGdldCBtYXJrZXIgaW5kZXhcbiAgICAgICAgdmFyICRpbmRleCA9ICgkKGxpKS5kYXRhKCdtYXJrZXItaW5kZXgnKSk7XG5cbiAgICAgICAgaWYgKGxhc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50UG9zaXRpb24gPSBtYXAubWFya2Vyc1skaW5kZXhdLmdldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudExhdCA9IGN1cnJlbnRQb3NpdGlvbi5sYXQoKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50TG5nID0gY3VycmVudFBvc2l0aW9uLmxuZygpO1xuXG4gICAgICAgICAgICB2YXIgbGFzdFBvc2l0aW9uID0gbWFwLm1hcmtlcnNbbGFzdEluZGV4XS5nZXRQb3NpdGlvbigpO1xuICAgICAgICAgICAgdmFyIGxhc3RMYXQgPSBsYXN0UG9zaXRpb24ubGF0KCk7XG4gICAgICAgICAgICB2YXIgbGFzdExuZyA9IGxhc3RQb3NpdGlvbi5sbmcoKTtcblxuICAgICAgICAgICAgdmFyIGN1cnJlbnRMYXRsbmcgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGN1cnJlbnRMYXQsIGN1cnJlbnRMbmcpO1xuICAgICAgICAgICAgdmFyIGxhc3RMYXRsbmcgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxhc3RMYXQsIGxhc3RMbmcpO1xuXG4gICAgICAgICAgICBtYXAuZHJhd1BvbHlsaW5lKHtcbiAgICAgICAgICAgICAgICBwYXRoOiBbY3VycmVudExhdGxuZywgbGFzdExhdGxuZ10sXG4gICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6IFwiIyNGRjAwMDBcIixcbiAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAxLjAsXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGlzdGFuY2UgKz0gZ29vZ2xlLm1hcHMuZ2VvbWV0cnkuc3BoZXJpY2FsLmNvbXB1dGVEaXN0YW5jZUJldHdlZW4oY3VycmVudExhdGxuZywgbGFzdExhdGxuZyk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXN0SW5kZXggPSAkaW5kZXg7XG4gICAgfSk7XG5cbiAgICAvLyBjb2xvciBtYXJrZXJzIG9uIGhvdmVyXG4gICAgJCgnI2Ryb3BfbGlzdCBsaScpLm1vdXNlZW50ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBnZXQgbWFya2VyIGluZGV4XG4gICAgICAgIHZhciAkaW5kZXggPSAoJCh0aGlzKS5kYXRhKCdtYXJrZXItaW5kZXgnKSk7XG4gICAgICAgIHZhciBtYXJrZXIgPSBtYXAubWFya2Vyc1skaW5kZXhdO1xuXG4gICAgICAgIG1hcmtlci5zZXRJY29uKGljb25Ib3Zlcik7XG4gICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGdldCBtYXJrZXIgaW5kZXhcbiAgICAgICAgdmFyICRpbmRleCA9ICgkKHRoaXMpLmRhdGEoJ21hcmtlci1pbmRleCcpKTtcbiAgICAgICAgdmFyIG1hcmtlciA9IG1hcC5tYXJrZXJzWyRpbmRleF07XG5cbiAgICAgICAgbWFya2VyLnNldEljb24oaWNvbkRlZmF1bHQpO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIExpc3RzIG1hcmtlcnNcbiAqXG4gKiBAcGFyYW0gaW5kZXhcbiAqIEBwYXJhbSBsYXRcbiAqIEBwYXJhbSBsbmdcbiAqIEBwYXJhbSBpZFxuICovXG5mdW5jdGlvbiBsaXN0TWFya2VycyhpbmRleCwgbGF0LCBsbmcsIGlkLCBuYW1lKSB7XG4gICAgLy8gYXBwZW5kIHRvIGxpc3RcbiAgICBkcm9wTGlzdC5hcHBlbmQoJzxsaSBpZD1cIm1hcmtlci1pZC0nICsgaWQgKyAnXCIgY2xhc3M9XCJtYXJrZXItbGlzdC1pdGVtJyArIGluZGV4ICsgJ1wiIGRhdGEtbWFya2VyLWluZGV4PVwiJyArIGluZGV4ICsgJ1wiPjxhIGhyZWY9XCJqYXZhc2NyaXB0OjtcIiBjbGFzcz1cIm1hcmtlci1saXN0LWFcIiBkYXRhLW1hcmtlci1pZD1cIicgKyBpZCArICdcIj4nICsgbmFtZSArICc8L2E+PGkgY2xhc3M9XCJmYSBmYS1zb3J0IHB1bGwtcmlnaHRcIj48L2k+PGEgaHJlZj1cIiNcIiBjbGFzcz1cImRlbGV0ZS1tYXJrZXJcIiBkYXRhLW1hcmtlci1pZD1cIicgKyBpZCArICdcIiBkYXRhLW1hcmtlci1pbmRleD1cIicgKyBpbmRleCArICdcIj48aSBjbGFzcz1cImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIHB1bGwtcmlnaHRcIj48L2k+PGEgaHJlZj1cIiNcIiBjbGFzcz1cImdvdG8tbWFya2VyXCIgZGF0YS1tYXJrZXItbGF0PVwiJyArIGxhdCArICdcIiBkYXRhLW1hcmtlci1sbmc9XCInICsgbG5nICsgJ1wiIGRhdGEtbWFya2VyLWluZGV4PVwiJyArIGluZGV4ICsgJ1wiPjxpIGNsYXNzPVwiZmEgZmEtZXllIHB1bGwtcmlnaHRcIj48L2k+PC9hPjwvbGk+Jyk7XG5cbiAgICAvLyBhbmQgbWFrZSBpdCBzb3J0YWJsZVxuICAgIGRyb3BMaXN0LnNvcnRhYmxlKHtcbiAgICAgICAgYXhpczogJ3knLFxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvYWRlci5zaG93KCk7XG5cbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9ICQodGhpcykuc29ydGFibGUoJ3NlcmlhbGl6ZScpO1xuXG4gICAgICAgICAgICAvLyB1cGRhdGUgdGhlIG9yZGVyIGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2Ryb3BzL3NvcnRtYXJrZXJzL1wiICsgQm9pbGVycGxhdGUuY3VycmVudERyb3BJZCxcbiAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXIuaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkcmF3IHJvdXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3Um91dGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBzZXQgYW1vdW50IG9mIG1hcmtlcnNcbiAgICBtYXJrZXJzQW1vdW50LnZhbCgkKCcjZHJvcF9saXN0IGxpJykubGVuZ3RoKTtcblxuICAgIC8vIHdoZW4gY2xpY2tpbmcgb24gYSBsaXN0IGl0ZW0gLS0+IHNob3cgbW9kYWxcbiAgICAkKCcubWFya2VyLWxpc3QtYScpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBpZCA9ICQodGhpcykuZGF0YSgnbWFya2VyLWlkJyk7XG5cbiAgICAgICAgc2hvd01hcmtlcihpZCk7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQWRkIGEgbWFya2VyXG4gKlxuICogQHBhcmFtIGluZGV4XG4gKiBAcGFyYW0gbGF0XG4gKiBAcGFyYW0gbG5nXG4gKi9cbmZ1bmN0aW9uIGFkZE1hcmtlcihpbmRleCwgbGF0LCBsbmcsIGlkKSB7XG4gICAgdmFyIG1hcmtlciA9IG1hcC5hZGRNYXJrZXIoe1xuICAgICAgICBsYXQ6IGxhdCxcbiAgICAgICAgbG5nOiBsbmcsXG4gICAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICAgICAgaWNvbjogaWNvbkRlZmF1bHQsXG4gICAgICAgIHRpdGxlOiAnTWFya2VyICMnICsgaW5kZXhcbiAgICB9KTtcblxuICAgIC8vIHNldCBpZCB0byBtYXJrZXJcbiAgICBtYXJrZXIuc2V0KCdpZCcsIGlkKTtcblxuICAgIC8vIHdoYXQgaGFwcGVucyB3aGVuIHlvdSBjbGljayBhIG1ha2VyXG4gICAgR01hcHMub24oJ2NsaWNrJywgbWFya2VyLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNob3dNYXJrZXIobWFya2VyLmlkKTtcbiAgICB9KTtcblxuICAgIC8vIHdoYXQgaGFwcGVucyB3aGVuIHlvdSBkcmFnZWQgYSBtYWtlclxuICAgIEdNYXBzLm9uKCdkcmFnZW5kJywgbWFya2VyLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2cobWFya2VyKTtcbiAgICAgICAgbG9hZGVyLnNob3coKTtcblxuICAgICAgICB2YXIgbWFya2VySWQgPSBtYXJrZXIuaWQ7XG5cbiAgICAgICAgLy8gdXBkYXRlIG1hcmtlciBpbiBkYXRhYmFzZVxuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdsYXQnLCBlLmxhdExuZy5sYXQoKSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbG5nJywgZS5sYXRMbmcubG5nKCkpO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgdXJsOiBcIi9tYXJrZXIvdXBkYXRlbGF0bG5nL1wiICsgbWFya2VySWQsXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVyLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBkcmF3IHJvdXRlXG4gICAgICAgICAgICAgICAgICAgIGRyYXdSb3V0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtlciBjb3VsZCBub3QgYmUgdXBkYXRlZDpcIiArIGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRyYXdSb3V0ZSgpO1xufVxuXG4vKipcbiAqIFNob3dzIHRoZSBtb2RhbCBvZiBhIG1hcmtlclxuICogQHBhcmFtIGlkXG4gKi9cbmZ1bmN0aW9uIHNob3dNYXJrZXIoaWQpe1xuICAgICQuYWpheCh7XG4gICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgIHVybDogXCIvbWFya2VyL3Nob3cvXCIgKyBpZCxcbiAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgLy8gcGxhY2Ugdmlld1xuICAgICAgICAgICAgICAgICQoJyNtb2RhbE1hcmtlciAubW9kYWwtYm9keScpLmh0bWwoZGF0YS52aWV3KTtcblxuICAgICAgICAgICAgICAgIC8vIGNoZWNrYm94IGV2ZW50XG4gICAgICAgICAgICAgICAgZXZlbnRDb250ZW50ID0gJCgnI2V2ZW50LWNvbnRlbnQnKTtcbiAgICAgICAgICAgICAgICAkKCcjZXZlbnQnKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50Q29udGVudC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudENvbnRlbnQuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzaG93IG1vZGFsXG4gICAgICAgICAgICAgICAgJCgnI21vZGFsTWFya2VyJykubW9kYWwoJ3Nob3cnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtlciBjb3VsZCBub3QgYmUgc2hvd246IFwiICsgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==