function showErrors(a){$(".alert-ajax").show(),$.each(a,function(a,n){$(".alert-ajax").find("ul").append("<li>"+n+"</li>")})}
function drawRoute(){var e=0,a=-1;map.removePolylines();var r=$("#drop_list li");r.each(function(r,t){var o=$(t).data("marker-index");if(-1!==a){var n=map.markers[o].getPosition(),s=n.lat(),l=n.lng(),i=map.markers[a].getPosition(),c=i.lat(),d=i.lng(),m=new google.maps.LatLng(s,l),p=new google.maps.LatLng(c,d);map.drawPolyline({path:[m,p],strokeColor:"##FF0000",strokeOpacity:1,strokeWeight:2}),e+=google.maps.geometry.spherical.computeDistanceBetween(m,p)}a=o}),$("#drop_list li").mouseenter(function(){var e=$(this).data("marker-index"),a=map.markers[e];a.setIcon(iconHover)}).mouseleave(function(){var e=$(this).data("marker-index"),a=map.markers[e];a.setIcon(iconDefault)})}function listMarkers(e,a,r,t,o){dropList.append('<li id="marker-id-'+t+'" class="marker-list-item'+e+'" data-marker-index="'+e+'"><a href="javascript:;" class="marker-list-a" data-marker-id="'+t+'">'+o+'</a><i class="fa fa-sort pull-right"></i><a href="#" class="delete-marker" data-marker-id="'+t+'" data-marker-index="'+e+'"><i class="glyphicon glyphicon-remove pull-right"></i><a href="#" class="goto-marker" data-marker-lat="'+a+'" data-marker-lng="'+r+'" data-marker-index="'+e+'"><i class="fa fa-eye pull-right"></i></a></li>'),dropList.sortable({axis:"y",update:function(){loader.show();var e=$(this).sortable("serialize");$.ajax({type:"POST",url:"/drops/sortmarkers/"+Boilerplate.currentDropId,processData:!1,cache:!1,dataType:"json",data:e,success:function(e){e.success&&(loader.hide(),drawRoute())},error:function(e){console.log(e)}})}}),markersAmount.val($("#drop_list li").length),$(".marker-list-a").click(function(){var e=$(this).data("marker-id");showMarker(e)})}function addMarker(e,a,r,t){var o=map.addMarker({lat:a,lng:r,draggable:!0,icon:iconDefault,title:"Marker #"+e});o.set("id",t),GMaps.on("click",o,function(){showMarker(o.id)}),GMaps.on("dragend",o,function(e){loader.show();var a=o.id,r=new FormData;r.append("lat",e.latLng.lat()),r.append("lng",e.latLng.lng()),$.ajax({method:"POST",url:"/marker/updatelatlng/"+a,processData:!1,contentType:!1,cache:!1,dataType:"json",data:r,success:function(e){1==e.success&&(loader.hide(),drawRoute())},error:function(e){console.log("Marker could not be updated:"+e)}})}),drawRoute()}function showMarker(e){$.ajax({type:"GET",url:"/marker/show/"+e,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(e){e.success&&($("#modalMarker .modal-body").html(e.view),eventContent=$("#event-content"),$("#event").change(function(){$(this).prop("checked")?eventContent.show():eventContent.hide()}),$("#modalMarker").modal("show"))},error:function(e){console.log("Marker could not be shown: "+e)}})}$(document).ready(function(){dropList=$("#drop_list"),markersAmount=$("#markers_amount"),iconDefault="http://maps.google.com/mapfiles/ms/icons/red-dot.png",iconHover="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",loader=$(".map_loader"),map=new GMaps({div:"#drop_map",zoom:15,lat:Boilerplate.currentDropLat,lng:Boilerplate.currentDropLng});var e=Boilerplate.currentDropMarkers;e&&$(e).each(function(){var e=map.markers.length,a=$(this)[0].lat,r=$(this)[0].lng,t=$(this)[0].id;listMarkers(e,a,r,$(this)[0].id,$(this)[0].name),addMarker(e,a,r,t)}),GMaps.on("click",map.map,function(e){loader.show();var a=map.markers.length,r=e.latLng.lat(),t=e.latLng.lng(),o=new FormData;o.append("name","Marker "+(a+1)),o.append("lat",r),o.append("lng",t),o.append("dropId",Boilerplate.currentDropId),$.ajax({type:"POST",url:"/marker/add",processData:!1,contentType:!1,cache:!1,dataType:"json",data:o,success:function(e){e.success&&(loader.hide(),addMarker(a,r,t,e.marker.id),listMarkers(a,r,t,e.marker.id,e.marker.name),drawRoute())},error:function(e){console.log("Marker could not be created: "+e)}})}),$(document).on("click",".goto-marker",function(e){e.preventDefault();var a,r,t=$(this).data("marker-index"),o=map.markers[t].getPosition();a=o.lat(),r=o.lng(),map.setCenter(a,r)}),$(document).on("click",".delete-marker",function(e){loader.show(),e.preventDefault();var a=$(this).data("marker-id"),r=$(this).data("marker-index"),t=map.markers[r];$.ajax({type:"DELETE",url:"/marker/delete/"+a,processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(e){e.success&&(loader.hide(),t.setMap(null),$(".marker-list-item"+r).remove(),markersAmount.val($("#drop_list li").length),drawRoute())},error:function(e){console.log("Marker could not be removed: "+e)}})}),$("#marker-submit").click(function(){var e=$("#current_marker").val(),a=0;$("#event").prop("checked")&&(a=1);var r=new FormData;r.append("name",$("#name").val()),r.append("hasEvent",a),$.ajax({method:"POST",url:"/marker/updateinfo/"+e,processData:!1,contentType:!1,cache:!1,dataType:"json",data:r,success:function(a){console.log(a),a.success?($("#marker-id-"+e+" .marker-list-a").html(a.marker.name),$(".alert-ajax").hide().find("ul").empty(),$("#modalMarker").modal("hide")):showErrors(a.errors)},error:function(e){console.log("Marker could not be updated the info:"+e)}})})});
!function(t,i,e,o){function s(i,e){this.options=t.extend(!0,{},n,e),this.input=i,this.$input=t(i),this._defaults=n,this._name="geocomplete",this.init()}var n={bounds:!0,country:null,map:!1,details:!1,detailsAttribute:"name",autoselect:!0,location:!1,mapOptions:{zoom:14,scrollwheel:!1,mapTypeId:"roadmap"},markerOptions:{draggable:!1},maxZoom:16,types:["geocode"],blur:!1},a="street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds".split(" "),r="id place_id url website vicinity reference name rating international_phone_number icon formatted_phone_number".split(" ");t.extend(s.prototype,{init:function(){this.initMap(),this.initMarker(),this.initGeocoder(),this.initDetails(),this.initLocation()},initMap:function(){if(this.options.map){if("function"==typeof this.options.map.setCenter)return void(this.map=this.options.map);this.map=new google.maps.Map(t(this.options.map)[0],this.options.mapOptions),google.maps.event.addListener(this.map,"click",t.proxy(this.mapClicked,this)),google.maps.event.addListener(this.map,"zoom_changed",t.proxy(this.mapZoomed,this))}},initMarker:function(){if(this.map){var i=t.extend(this.options.markerOptions,{map:this.map});i.disabled||(this.marker=new google.maps.Marker(i),google.maps.event.addListener(this.marker,"dragend",t.proxy(this.markerDragged,this)))}},initGeocoder:function(){var i={types:this.options.types,bounds:this.options.bounds===!0?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};this.options.country&&(i.componentRestrictions={country:this.options.country}),this.autocomplete=new google.maps.places.Autocomplete(this.input,i),this.geocoder=new google.maps.Geocoder,this.map&&this.options.bounds===!0&&this.autocomplete.bindTo("bounds",this.map),google.maps.event.addListener(this.autocomplete,"place_changed",t.proxy(this.placeChanged,this)),this.$input.keypress(function(t){return 13===t.keyCode?!1:void 0}),this.$input.bind("geocode",t.proxy(function(){this.find()},this)),this.options.blur===!0&&this.$input.blur(t.proxy(function(){this.find()},this))},initDetails:function(){function i(t){s[t]=e.find("["+o+"="+t+"]")}if(this.options.details){var e=t(this.options.details),o=this.options.detailsAttribute,s={};t.each(a,function(t,e){i(e),i(e+"_short")}),t.each(r,function(t,e){i(e)}),this.$details=e,this.details=s}},initLocation:function(){var t,i=this.options.location;if(i){if("string"==typeof i)return void this.find(i);i instanceof Array&&(t=new google.maps.LatLng(i[0],i[1])),i instanceof google.maps.LatLng&&(t=i),t&&(this.map&&this.map.setCenter(t),this.marker&&this.marker.setPosition(t))}},find:function(t){this.geocode({address:t||this.$input.val()})},geocode:function(i){this.options.bounds&&!i.bounds&&(i.bounds=this.options.bounds===!0?this.map&&this.map.getBounds():this.options.bounds),this.options.country&&(i.region=this.options.country),this.geocoder.geocode(i,t.proxy(this.handleGeocode,this))},selectFirstResult:function(){var i="";t(".pac-item-selected")[0]&&(i="-selected");var e=t(".pac-container .pac-item"+i+":first span:nth-child(2)").text(),o=t(".pac-container .pac-item"+i+":first span:nth-child(3)").text(),s=e;return o&&(s+=" - "+o),this.$input.val(s),s},handleGeocode:function(t,i){if(i===google.maps.GeocoderStatus.OK){var e=t[0];this.$input.val(e.formatted_address),this.update(e),t.length>1&&this.trigger("geocode:multiple",t)}else this.trigger("geocode:error",i)},trigger:function(t,i){this.$input.trigger(t,[i])},center:function(t){t.viewport?(this.map.fitBounds(t.viewport),this.map.getZoom()>this.options.maxZoom&&this.map.setZoom(this.options.maxZoom)):(this.map.setZoom(this.options.maxZoom),this.map.setCenter(t.location)),this.marker&&(this.marker.setPosition(t.location),this.marker.setAnimation(this.options.markerOptions.animation))},update:function(t){this.map&&this.center(t.geometry),this.$details&&this.fillDetails(t),this.trigger("geocode:result",t)},fillDetails:function(i){var e={},o=i.geometry,s=o.viewport,n=o.bounds;t.each(i.address_components,function(i,o){o.types[0];t.each(o.types,function(t,i){e[i]=o.long_name,e[i+"_short"]=o.short_name})}),t.each(r,function(t,o){e[o]=i[o]}),t.extend(e,{formatted_address:i.formatted_address,location_type:o.location_type||"PLACES",viewport:s,bounds:n,location:o.location,lat:o.location.lat(),lng:o.location.lng()}),t.each(this.details,t.proxy(function(t,i){var o=e[t];this.setDetail(i,o)},this)),this.data=e},setDetail:function(t,i){i===o?i="":"function"==typeof i.toUrlValue&&(i=i.toUrlValue()),t.is(":input")?t.val(i):t.text(i)},markerDragged:function(t){this.trigger("geocode:dragged",t.latLng)},mapClicked:function(t){this.trigger("geocode:click",t.latLng)},mapZoomed:function(){this.trigger("geocode:zoom",this.map.getZoom())},resetMarker:function(){this.marker.setPosition(this.data.location),this.setDetail(this.details.lat,this.data.location.lat()),this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var t=this.autocomplete.getPlace();if(t&&t.geometry)this.update(t);else if(this.options.autoselect){var i=this.selectFirstResult();this.find(i)}}}),t.fn.geocomplete=function(i){var e="plugin_geocomplete";if("string"==typeof i){var o=t(this).data(e)||t(this).geocomplete().data(e),n=o[i];return"function"==typeof n?(n.apply(o,Array.prototype.slice.call(arguments,1)),t(this)):(2==arguments.length&&(n=arguments[1]),n)}return this.each(function(){var o=t.data(this,e);o||(o=new s(this,i),t.data(this,e,o))})}}(jQuery,window,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJkcm9wL2FkZF9lZGl0LmpzIiwidmVuZG9yL2dlb2NvbXBsZXRlL2pxdWVyeS5nZW9jb21wbGV0ZS5qcyJdLCJuYW1lcyI6WyJzaG93RXJyb3JzIiwiZXJyb3JzIiwiJCIsInNob3ciLCJlYWNoIiwiaW5kZXgiLCJlcnJvciIsImZpbmQiLCJhcHBlbmQiLCJkcmF3Um91dGUiLCJkaXN0YW5jZSIsImxhc3RJbmRleCIsIm1hcCIsInJlbW92ZVBvbHlsaW5lcyIsImRyb3BMaXN0IiwiaWR4IiwibGkiLCIkaW5kZXgiLCJkYXRhIiwiY3VycmVudFBvc2l0aW9uIiwibWFya2VycyIsImdldFBvc2l0aW9uIiwiY3VycmVudExhdCIsImxhdCIsImN1cnJlbnRMbmciLCJsbmciLCJsYXN0UG9zaXRpb24iLCJsYXN0TGF0IiwibGFzdExuZyIsImN1cnJlbnRMYXRsbmciLCJnb29nbGUiLCJtYXBzIiwiTGF0TG5nIiwibGFzdExhdGxuZyIsImRyYXdQb2x5bGluZSIsInBhdGgiLCJzdHJva2VDb2xvciIsInN0cm9rZU9wYWNpdHkiLCJzdHJva2VXZWlnaHQiLCJnZW9tZXRyeSIsInNwaGVyaWNhbCIsImNvbXB1dGVEaXN0YW5jZUJldHdlZW4iLCJtb3VzZWVudGVyIiwidGhpcyIsIm1hcmtlciIsInNldEljb24iLCJpY29uSG92ZXIiLCJtb3VzZWxlYXZlIiwiaWNvbkRlZmF1bHQiLCJsaXN0TWFya2VycyIsImlkIiwibmFtZSIsInNvcnRhYmxlIiwiYXhpcyIsInVwZGF0ZSIsImxvYWRlciIsImZvcm1EYXRhIiwiYWpheCIsInR5cGUiLCJ1cmwiLCJCb2lsZXJwbGF0ZSIsImN1cnJlbnREcm9wSWQiLCJwcm9jZXNzRGF0YSIsImNhY2hlIiwiZGF0YVR5cGUiLCJzdWNjZXNzIiwiaGlkZSIsImNvbnNvbGUiLCJsb2ciLCJtYXJrZXJzQW1vdW50IiwidmFsIiwibGVuZ3RoIiwiY2xpY2siLCJzaG93TWFya2VyIiwiYWRkTWFya2VyIiwiZHJhZ2dhYmxlIiwiaWNvbiIsInRpdGxlIiwic2V0IiwiR01hcHMiLCJvbiIsImUiLCJtYXJrZXJJZCIsIkZvcm1EYXRhIiwibGF0TG5nIiwibWV0aG9kIiwiY29udGVudFR5cGUiLCJodG1sIiwidmlldyIsImV2ZW50Q29udGVudCIsImNoYW5nZSIsInByb3AiLCJtb2RhbCIsImRvY3VtZW50IiwicmVhZHkiLCJkaXYiLCJ6b29tIiwiY3VycmVudERyb3BMYXQiLCJjdXJyZW50RHJvcExuZyIsImN1cnJlbnREcm9wTWFya2VycyIsIm1hcmtlckluZGV4IiwibWFya2VyTGF0IiwibWFya2VyTG5nIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInBvc2l0aW9uIiwic2V0Q2VudGVyIiwic2V0TWFwIiwicmVtb3ZlIiwibWFya2VySGFzRXZlbnQiLCJlbXB0eSIsIndpbmRvdyIsInVuZGVmaW5lZCIsIkdlb0NvbXBsZXRlIiwiaW5wdXQiLCJvcHRpb25zIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCIkaW5wdXQiLCJfZGVmYXVsdHMiLCJfbmFtZSIsImluaXQiLCJib3VuZHMiLCJjb3VudHJ5IiwiZGV0YWlscyIsImRldGFpbHNBdHRyaWJ1dGUiLCJhdXRvc2VsZWN0IiwibG9jYXRpb24iLCJtYXBPcHRpb25zIiwic2Nyb2xsd2hlZWwiLCJtYXBUeXBlSWQiLCJtYXJrZXJPcHRpb25zIiwibWF4Wm9vbSIsInR5cGVzIiwiYmx1ciIsImNvbXBvbmVudFR5cGVzIiwic3BsaXQiLCJwbGFjZXNEZXRhaWxzIiwicHJvdG90eXBlIiwiaW5pdE1hcCIsImluaXRNYXJrZXIiLCJpbml0R2VvY29kZXIiLCJpbml0RGV0YWlscyIsImluaXRMb2NhdGlvbiIsIk1hcCIsImFkZExpc3RlbmVyIiwicHJveHkiLCJtYXBDbGlja2VkIiwibWFwWm9vbWVkIiwiZGlzYWJsZWQiLCJNYXJrZXIiLCJtYXJrZXJEcmFnZ2VkIiwiY29tcG9uZW50UmVzdHJpY3Rpb25zIiwiYXV0b2NvbXBsZXRlIiwicGxhY2VzIiwiQXV0b2NvbXBsZXRlIiwiZ2VvY29kZXIiLCJHZW9jb2RlciIsImJpbmRUbyIsInBsYWNlQ2hhbmdlZCIsImtleXByZXNzIiwia2V5Q29kZSIsImJpbmQiLCJzZXREZXRhaWwiLCJ2YWx1ZSIsIiRkZXRhaWxzIiwiYXR0cmlidXRlIiwia2V5IiwiQXJyYXkiLCJzZXRQb3NpdGlvbiIsImFkZHJlc3MiLCJnZW9jb2RlIiwicmVxdWVzdCIsImdldEJvdW5kcyIsInJlZ2lvbiIsImhhbmRsZUdlb2NvZGUiLCJzZWxlY3RGaXJzdFJlc3VsdCIsInNlbGVjdGVkIiwiJHNwYW4xIiwidGV4dCIsIiRzcGFuMiIsImZpcnN0UmVzdWx0IiwicmVzdWx0cyIsInN0YXR1cyIsIkdlb2NvZGVyU3RhdHVzIiwiT0siLCJyZXN1bHQiLCJmb3JtYXR0ZWRfYWRkcmVzcyIsInRyaWdnZXIiLCJhcmd1bWVudCIsImNlbnRlciIsInZpZXdwb3J0IiwiZml0Qm91bmRzIiwiZ2V0Wm9vbSIsInNldFpvb20iLCJzZXRBbmltYXRpb24iLCJhbmltYXRpb24iLCJmaWxsRGV0YWlscyIsImFkZHJlc3NfY29tcG9uZW50cyIsIm9iamVjdCIsImxvbmdfbmFtZSIsInNob3J0X25hbWUiLCJsb2NhdGlvbl90eXBlIiwiJGRldGFpbCIsIiRlbGVtZW50IiwidG9VcmxWYWx1ZSIsImlzIiwicmVzZXRNYXJrZXIiLCJwbGFjZSIsImdldFBsYWNlIiwiYXV0b1NlbGVjdGlvbiIsImZuIiwiZ2VvY29tcGxldGUiLCJpbnN0YW5jZSIsImFwcGx5Iiwic2xpY2UiLCJjYWxsIiwiYXJndW1lbnRzIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQUFBQSxRQUFTQSxZQUFXQyxHQUVoQkMsRUFBRSxlQUFlQyxPQUNqQkQsRUFBRUUsS0FBS0gsRUFBUSxTQUFTSSxFQUFPQyxHQUMzQkosRUFBRSxlQUFlSyxLQUFLLE1BQU1DLE9BQU8sT0FBU0YsRUFBUTtBQ3lLNUQsUUFBU0csYUFDTCxHQUFJQyxHQUFXLEVBQ1hDLEVBQVksRUFFaEJDLEtBQUlDLGlCQUVKLElBQUlDLEdBQVdaLEVBQUUs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QUFNOUIsVUFBVTZFLE1BQU1DLEtBQUtDLFVBQVcsSUFDcER2TixFQUFFeUMsUUFFZSxHQUFwQjhLLFVBQVVsSixTQUNab0IsRUFBTzhILFVBQVUsSUFFWjlILEdBR1QsTUFBT2hELE1BQUt2QyxLQUFLLFdBRWYsR0FBSWlOLEdBQVduTixFQUFFZ0IsS0FBS3lCLEtBQU0ySCxFQUN2QitDLEtBQ0hBLEVBQVcsR0FBSXBHLEdBQWF0RSxLQUFNd0UsR0FDbENqSCxFQUFFZ0IsS0FBS3lCLEtBQU0ySCxFQUFXK0MsUUFNOUJLLE9BQVEzRyxPQUFRbEIiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHNob3dFcnJvcnMoZXJyb3JzKXtcbiAgICAvLyBzaG93IGVycm9ycyBpbiBhbGVydC1hamF4XG4gICAgJCgnLmFsZXJ0LWFqYXgnKS5zaG93KCk7XG4gICAgJC5lYWNoKGVycm9ycywgZnVuY3Rpb24oaW5kZXgsIGVycm9yKXtcbiAgICAgICAgJCgnLmFsZXJ0LWFqYXgnKS5maW5kKCd1bCcpLmFwcGVuZCgnPGxpPicgKyBlcnJvciArICc8L2xpPicpO1xuICAgIH0pO1xufSIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICBkcm9wTGlzdCA9ICQoJyNkcm9wX2xpc3QnKTtcbiAgICBtYXJrZXJzQW1vdW50ID0gJCgnI21hcmtlcnNfYW1vdW50Jyk7XG4gICAgaWNvbkRlZmF1bHQgPSAnaHR0cDovL21hcHMuZ29vZ2xlLmNvbS9tYXBmaWxlcy9tcy9pY29ucy9yZWQtZG90LnBuZyc7XG4gICAgaWNvbkhvdmVyID0gJ2h0dHA6Ly9tYXBzLmdvb2dsZS5jb20vbWFwZmlsZXMvbXMvaWNvbnMvYmx1ZS1kb3QucG5nJztcbiAgICBsb2FkZXIgPSAkKCcubWFwX2xvYWRlcicpO1xuXG4gICAgLy8gaW5pdCBtYXBcbiAgICBtYXAgPSBuZXcgR01hcHMoe1xuICAgICAgICBkaXY6ICcjZHJvcF9tYXAnLFxuICAgICAgICB6b29tOiAxNSxcbiAgICAgICAgbGF0OiBCb2lsZXJwbGF0ZS5jdXJyZW50RHJvcExhdCxcbiAgICAgICAgbG5nOiBCb2lsZXJwbGF0ZS5jdXJyZW50RHJvcExuZ1xuICAgIH0pO1xuXG4gICAgLy8gaWYgdGhlcmUgYXJlIG1hcmtlcnMgZm91bmRcbiAgICB2YXIgbWFya2VycyA9IEJvaWxlcnBsYXRlLmN1cnJlbnREcm9wTWFya2VycztcbiAgICBpZiAobWFya2Vycykge1xuICAgICAgICAkKG1hcmtlcnMpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1hcmtlckluZGV4ID0gbWFwLm1hcmtlcnMubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIG1hcmtlckxhdCA9ICQodGhpcylbMF0ubGF0O1xuICAgICAgICAgICAgdmFyIG1hcmtlckxuZyA9ICQodGhpcylbMF0ubG5nO1xuICAgICAgICAgICAgdmFyIG1hcmtlcklkID0gJCh0aGlzKVswXS5pZDtcblxuICAgICAgICAgICAgbGlzdE1hcmtlcnMobWFya2VySW5kZXgsIG1hcmtlckxhdCwgbWFya2VyTG5nLCAkKHRoaXMpWzBdLmlkLCAkKHRoaXMpWzBdLm5hbWUpO1xuICAgICAgICAgICAgYWRkTWFya2VyKG1hcmtlckluZGV4LCBtYXJrZXJMYXQsIG1hcmtlckxuZywgbWFya2VySWQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBhZGQgYSBtYXJrZXJcbiAgICBHTWFwcy5vbignY2xpY2snLCBtYXAubWFwLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgbG9hZGVyLnNob3coKTtcbiAgICAgICAgdmFyIG1hcmtlckluZGV4ID0gbWFwLm1hcmtlcnMubGVuZ3RoO1xuICAgICAgICB2YXIgbWFya2VyTGF0ID0gZXZlbnQubGF0TG5nLmxhdCgpO1xuICAgICAgICB2YXIgbWFya2VyTG5nID0gZXZlbnQubGF0TG5nLmxuZygpO1xuXG4gICAgICAgIC8vIHB1c2ggbWFya2VyIHRvIGRhdGFiYXNlXG4gICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCAnTWFya2VyICcgKyAobWFya2VySW5kZXggKyAxKSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbGF0JywgbWFya2VyTGF0KTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdsbmcnLCBtYXJrZXJMbmcpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2Ryb3BJZCcsIEJvaWxlcnBsYXRlLmN1cnJlbnREcm9wSWQpO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcbiAgICAgICAgICAgIHVybDogXCIvbWFya2VyL2FkZFwiLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhKVxuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBsb2FkZXIuaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFkZE1hcmtlcihtYXJrZXJJbmRleCwgbWFya2VyTGF0LCBtYXJrZXJMbmcsIGRhdGEubWFya2VyLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdE1hcmtlcnMobWFya2VySW5kZXgsIG1hcmtlckxhdCwgbWFya2VyTG5nLCBkYXRhLm1hcmtlci5pZCwgZGF0YS5tYXJrZXIubmFtZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZHJhd1JvdXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWFya2VyIGNvdWxkIG5vdCBiZSBjcmVhdGVkOiBcIiArIGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIHdoZW4gY2xpY2tpbmcgb24gdGhlIG1hcmtlclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZ290by1tYXJrZXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIG1hcmtlckxhdCwgbWFya2VyTG5nO1xuXG4gICAgICAgIHZhciAkaW5kZXggPSAkKHRoaXMpLmRhdGEoJ21hcmtlci1pbmRleCcpO1xuICAgICAgICB2YXIgcG9zaXRpb24gPSBtYXAubWFya2Vyc1skaW5kZXhdLmdldFBvc2l0aW9uKCk7XG5cbiAgICAgICAgbWFya2VyTGF0ID0gcG9zaXRpb24ubGF0KCk7XG4gICAgICAgIG1hcmtlckxuZyA9IHBvc2l0aW9uLmxuZygpO1xuXG4gICAgICAgIG1hcC5zZXRDZW50ZXIobWFya2VyTGF0LCBtYXJrZXJMbmcpO1xuICAgIH0pO1xuXG4gICAgLy8gd2hlbiBkZWxldGluZyBhIG1hcmtlclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZGVsZXRlLW1hcmtlcicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGxvYWRlci5zaG93KCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB2YXIgaWQgPSAkKHRoaXMpLmRhdGEoJ21hcmtlci1pZCcpO1xuICAgICAgICB2YXIgJGluZGV4ID0gJCh0aGlzKS5kYXRhKCdtYXJrZXItaW5kZXgnKTtcbiAgICAgICAgdmFyIG1hcmtlciA9IG1hcC5tYXJrZXJzWyRpbmRleF07XG5cbiAgICAgICAgLy8gZGVsZXRlIG1hcmtlciBmcm9tIGRhdGFiYXNlXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgdXJsOiBcIi9tYXJrZXIvZGVsZXRlL1wiICsgaWQsXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlci5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gbWFwXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gbGlzdFxuICAgICAgICAgICAgICAgICAgICAkKCcubWFya2VyLWxpc3QtaXRlbScgKyAkaW5kZXgpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBhbW91bnQgb2YgbWFya2Vyc1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzQW1vdW50LnZhbCgkKCcjZHJvcF9saXN0IGxpJykubGVuZ3RoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBkcmF3IHJvdXRlXG4gICAgICAgICAgICAgICAgICAgIGRyYXdSb3V0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtlciBjb3VsZCBub3QgYmUgcmVtb3ZlZDogXCIgKyBkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyB3aGVuIHVwZGF0aW5nIG1hcmtlcnMgaW5mb1xuICAgICQoJyNtYXJrZXItc3VibWl0JykuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG1hcmtlcklkID0gJCgnI2N1cnJlbnRfbWFya2VyJykudmFsKCk7XG5cbiAgICAgICAgdmFyIG1hcmtlckhhc0V2ZW50ID0gMDtcbiAgICAgICAgaWYoJCgnI2V2ZW50JykucHJvcCgnY2hlY2tlZCcpKSBtYXJrZXJIYXNFdmVudCA9IDE7XG5cbiAgICAgICAgLy8gdXBkYXRlIG1hcmtlciBpbiBkYXRhYmFzZVxuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJywgJCgnI25hbWUnKS52YWwoKSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnaGFzRXZlbnQnLCBtYXJrZXJIYXNFdmVudCk7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICB1cmw6IFwiL21hcmtlci91cGRhdGVpbmZvL1wiICsgbWFya2VySWQsXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpXG5cbiAgICAgICAgICAgICAgICAvLyBmb3JtIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdmlld1xuICAgICAgICAgICAgICAgICAgICAkKCcjbWFya2VyLWlkLScgKyBtYXJrZXJJZCArICcgLm1hcmtlci1saXN0LWEnKS5odG1sKGRhdGEubWFya2VyLm5hbWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgZXJyb3JzXG4gICAgICAgICAgICAgICAgICAgICQoJy5hbGVydC1hamF4JykuaGlkZSgpLmZpbmQoJ3VsJykuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIG1vZGFsXG4gICAgICAgICAgICAgICAgICAgICQoJyNtb2RhbE1hcmtlcicpLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGZvcm0gaXMgaW52YWxpZFxuICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHNob3dFcnJvcnMoZGF0YS5lcnJvcnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtlciBjb3VsZCBub3QgYmUgdXBkYXRlZCB0aGUgaW5mbzpcIiArIGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vKipcbiAqIERyYXcgdGhlIHJvdXRlIG9uIHRoZSBtYXBcbiAqL1xuZnVuY3Rpb24gZHJhd1JvdXRlKCkge1xuICAgIHZhciBkaXN0YW5jZSA9IDA7XG4gICAgdmFyIGxhc3RJbmRleCA9IC0xO1xuXG4gICAgbWFwLnJlbW92ZVBvbHlsaW5lcygpO1xuXG4gICAgdmFyIGRyb3BMaXN0ID0gJChcIiNkcm9wX2xpc3QgbGlcIik7XG4gICAgZHJvcExpc3QuZWFjaChmdW5jdGlvbiAoaWR4LCBsaSkge1xuICAgICAgICAvLyBnZXQgbWFya2VyIGluZGV4XG4gICAgICAgIHZhciAkaW5kZXggPSAoJChsaSkuZGF0YSgnbWFya2VyLWluZGV4JykpO1xuXG4gICAgICAgIGlmIChsYXN0SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudFBvc2l0aW9uID0gbWFwLm1hcmtlcnNbJGluZGV4XS5nZXRQb3NpdGlvbigpO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRMYXQgPSBjdXJyZW50UG9zaXRpb24ubGF0KCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudExuZyA9IGN1cnJlbnRQb3NpdGlvbi5sbmcoKTtcblxuICAgICAgICAgICAgdmFyIGxhc3RQb3NpdGlvbiA9IG1hcC5tYXJrZXJzW2xhc3RJbmRleF0uZ2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIHZhciBsYXN0TGF0ID0gbGFzdFBvc2l0aW9uLmxhdCgpO1xuICAgICAgICAgICAgdmFyIGxhc3RMbmcgPSBsYXN0UG9zaXRpb24ubG5nKCk7XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50TGF0bG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhjdXJyZW50TGF0LCBjdXJyZW50TG5nKTtcbiAgICAgICAgICAgIHZhciBsYXN0TGF0bG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsYXN0TGF0LCBsYXN0TG5nKTtcblxuICAgICAgICAgICAgbWFwLmRyYXdQb2x5bGluZSh7XG4gICAgICAgICAgICAgICAgcGF0aDogW2N1cnJlbnRMYXRsbmcsIGxhc3RMYXRsbmddLFxuICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiBcIiMjRkYwMDAwXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMS4wLFxuICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRpc3RhbmNlICs9IGdvb2dsZS5tYXBzLmdlb21ldHJ5LnNwaGVyaWNhbC5jb21wdXRlRGlzdGFuY2VCZXR3ZWVuKGN1cnJlbnRMYXRsbmcsIGxhc3RMYXRsbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGFzdEluZGV4ID0gJGluZGV4O1xuICAgIH0pO1xuXG4gICAgLy8gY29sb3IgbWFya2VycyBvbiBob3ZlclxuICAgICQoJyNkcm9wX2xpc3QgbGknKS5tb3VzZWVudGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gZ2V0IG1hcmtlciBpbmRleFxuICAgICAgICB2YXIgJGluZGV4ID0gKCQodGhpcykuZGF0YSgnbWFya2VyLWluZGV4JykpO1xuICAgICAgICB2YXIgbWFya2VyID0gbWFwLm1hcmtlcnNbJGluZGV4XTtcblxuICAgICAgICBtYXJrZXIuc2V0SWNvbihpY29uSG92ZXIpO1xuICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBnZXQgbWFya2VyIGluZGV4XG4gICAgICAgIHZhciAkaW5kZXggPSAoJCh0aGlzKS5kYXRhKCdtYXJrZXItaW5kZXgnKSk7XG4gICAgICAgIHZhciBtYXJrZXIgPSBtYXAubWFya2Vyc1skaW5kZXhdO1xuXG4gICAgICAgIG1hcmtlci5zZXRJY29uKGljb25EZWZhdWx0KTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBMaXN0cyBtYXJrZXJzXG4gKlxuICogQHBhcmFtIGluZGV4XG4gKiBAcGFyYW0gbGF0XG4gKiBAcGFyYW0gbG5nXG4gKiBAcGFyYW0gaWRcbiAqL1xuZnVuY3Rpb24gbGlzdE1hcmtlcnMoaW5kZXgsIGxhdCwgbG5nLCBpZCwgbmFtZSkge1xuICAgIC8vIGFwcGVuZCB0byBsaXN0XG4gICAgZHJvcExpc3QuYXBwZW5kKCc8bGkgaWQ9XCJtYXJrZXItaWQtJyArIGlkICsgJ1wiIGNsYXNzPVwibWFya2VyLWxpc3QtaXRlbScgKyBpbmRleCArICdcIiBkYXRhLW1hcmtlci1pbmRleD1cIicgKyBpbmRleCArICdcIj48YSBocmVmPVwiamF2YXNjcmlwdDo7XCIgY2xhc3M9XCJtYXJrZXItbGlzdC1hXCIgZGF0YS1tYXJrZXItaWQ9XCInICsgaWQgKyAnXCI+JyArIG5hbWUgKyAnPC9hPjxpIGNsYXNzPVwiZmEgZmEtc29ydCBwdWxsLXJpZ2h0XCI+PC9pPjxhIGhyZWY9XCIjXCIgY2xhc3M9XCJkZWxldGUtbWFya2VyXCIgZGF0YS1tYXJrZXItaWQ9XCInICsgaWQgKyAnXCIgZGF0YS1tYXJrZXItaW5kZXg9XCInICsgaW5kZXggKyAnXCI+PGkgY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSBwdWxsLXJpZ2h0XCI+PC9pPjxhIGhyZWY9XCIjXCIgY2xhc3M9XCJnb3RvLW1hcmtlclwiIGRhdGEtbWFya2VyLWxhdD1cIicgKyBsYXQgKyAnXCIgZGF0YS1tYXJrZXItbG5nPVwiJyArIGxuZyArICdcIiBkYXRhLW1hcmtlci1pbmRleD1cIicgKyBpbmRleCArICdcIj48aSBjbGFzcz1cImZhIGZhLWV5ZSBwdWxsLXJpZ2h0XCI+PC9pPjwvYT48L2xpPicpO1xuXG4gICAgLy8gYW5kIG1ha2UgaXQgc29ydGFibGVcbiAgICBkcm9wTGlzdC5zb3J0YWJsZSh7XG4gICAgICAgIGF4aXM6ICd5JyxcbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsb2FkZXIuc2hvdygpO1xuXG4gICAgICAgICAgICB2YXIgZm9ybURhdGEgPSAkKHRoaXMpLnNvcnRhYmxlKCdzZXJpYWxpemUnKTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBvcmRlciBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9kcm9wcy9zb3J0bWFya2Vycy9cIiArIEJvaWxlcnBsYXRlLmN1cnJlbnREcm9wSWQsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZHJhdyByb3V0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd1JvdXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gc2V0IGFtb3VudCBvZiBtYXJrZXJzXG4gICAgbWFya2Vyc0Ftb3VudC52YWwoJCgnI2Ryb3BfbGlzdCBsaScpLmxlbmd0aCk7XG5cbiAgICAvLyB3aGVuIGNsaWNraW5nIG9uIGEgbGlzdCBpdGVtIC0tPiBzaG93IG1vZGFsXG4gICAgJCgnLm1hcmtlci1saXN0LWEnKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICB2YXIgaWQgPSAkKHRoaXMpLmRhdGEoJ21hcmtlci1pZCcpO1xuXG4gICAgICAgIHNob3dNYXJrZXIoaWQpO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIEFkZCBhIG1hcmtlclxuICpcbiAqIEBwYXJhbSBpbmRleFxuICogQHBhcmFtIGxhdFxuICogQHBhcmFtIGxuZ1xuICovXG5mdW5jdGlvbiBhZGRNYXJrZXIoaW5kZXgsIGxhdCwgbG5nLCBpZCkge1xuICAgIHZhciBtYXJrZXIgPSBtYXAuYWRkTWFya2VyKHtcbiAgICAgICAgbGF0OiBsYXQsXG4gICAgICAgIGxuZzogbG5nLFxuICAgICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICAgIGljb246IGljb25EZWZhdWx0LFxuICAgICAgICB0aXRsZTogJ01hcmtlciAjJyArIGluZGV4XG4gICAgfSk7XG5cbiAgICAvLyBzZXQgaWQgdG8gbWFya2VyXG4gICAgbWFya2VyLnNldCgnaWQnLCBpZCk7XG5cbiAgICAvLyB3aGF0IGhhcHBlbnMgd2hlbiB5b3UgY2xpY2sgYSBtYWtlclxuICAgIEdNYXBzLm9uKCdjbGljaycsIG1hcmtlciwgZnVuY3Rpb24oZSkge1xuICAgICAgICBzaG93TWFya2VyKG1hcmtlci5pZCk7XG4gICAgfSk7XG5cbiAgICAvLyB3aGF0IGhhcHBlbnMgd2hlbiB5b3UgZHJhZ2VkIGEgbWFrZXJcbiAgICBHTWFwcy5vbignZHJhZ2VuZCcsIG1hcmtlciwgZnVuY3Rpb24oZSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKG1hcmtlcik7XG4gICAgICAgIGxvYWRlci5zaG93KCk7XG5cbiAgICAgICAgdmFyIG1hcmtlcklkID0gbWFya2VyLmlkO1xuXG4gICAgICAgIC8vIHVwZGF0ZSBtYXJrZXIgaW4gZGF0YWJhc2VcbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbGF0JywgZS5sYXRMbmcubGF0KCkpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2xuZycsIGUubGF0TG5nLmxuZygpKTtcblxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIHVybDogXCIvbWFya2VyL3VwZGF0ZWxhdGxuZy9cIiArIG1hcmtlcklkLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlci5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZHJhdyByb3V0ZVxuICAgICAgICAgICAgICAgICAgICBkcmF3Um91dGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJNYXJrZXIgY291bGQgbm90IGJlIHVwZGF0ZWQ6XCIgKyBkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkcmF3Um91dGUoKTtcbn1cblxuLyoqXG4gKiBTaG93cyB0aGUgbW9kYWwgb2YgYSBtYXJrZXJcbiAqIEBwYXJhbSBpZFxuICovXG5mdW5jdGlvbiBzaG93TWFya2VyKGlkKXtcbiAgICAkLmFqYXgoe1xuICAgICAgICB0eXBlOiBcIkdFVFwiLFxuICAgICAgICB1cmw6IFwiL21hcmtlci9zaG93L1wiICsgaWQsXG4gICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgIC8vIHBsYWNlIHZpZXdcbiAgICAgICAgICAgICAgICAkKCcjbW9kYWxNYXJrZXIgLm1vZGFsLWJvZHknKS5odG1sKGRhdGEudmlldyk7XG5cbiAgICAgICAgICAgICAgICAvLyBjaGVja2JveCBldmVudFxuICAgICAgICAgICAgICAgIGV2ZW50Q29udGVudCA9ICQoJyNldmVudC1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgJCgnI2V2ZW50JykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudENvbnRlbnQuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRDb250ZW50LmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gc2hvdyBtb2RhbFxuICAgICAgICAgICAgICAgICQoJyNtb2RhbE1hcmtlcicpLm1vZGFsKCdzaG93Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNYXJrZXIgY291bGQgbm90IGJlIHNob3duOiBcIiArIGRhdGEpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4iLCIvKipcbiAqIGpRdWVyeSBHZW9jb2RpbmcgYW5kIFBsYWNlcyBBdXRvY29tcGxldGUgUGx1Z2luIC0gViAxLjYuMVxuICpcbiAqIEBhdXRob3IgTWFydGluIEtsZXBwZSA8a2xlcHBlQHViaWxhYnMubmV0PiwgMjAxNFxuICogQGF1dGhvciBVYmlsYWJzIGh0dHA6Ly91YmlsYWJzLm5ldCwgMjAxNFxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2UgPGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwPlxuICovXG5cbi8vICMgJC5nZW9jb21wbGV0ZSgpXG4vLyAjIyBqUXVlcnkgR2VvY29kaW5nIGFuZCBQbGFjZXMgQXV0b2NvbXBsZXRlIFBsdWdpblxuLy9cbi8vICogaHR0cHM6Ly9naXRodWIuY29tL3ViaWxhYnMvZ2VvY29tcGxldGUvXG4vLyAqIGJ5IE1hcnRpbiBLbGVwcGUgPGtsZXBwZUB1YmlsYWJzLm5ldD5cblxuKGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCl7XG5cbiAgLy8gIyMgT3B0aW9uc1xuICAvLyBUaGUgZGVmYXVsdCBvcHRpb25zIGZvciB0aGlzIHBsdWdpbi5cbiAgLy9cbiAgLy8gKiBgbWFwYCAtIE1pZ2h0IGJlIGEgc2VsZWN0b3IsIGFuIGpRdWVyeSBvYmplY3Qgb3IgYSBET00gZWxlbWVudC4gRGVmYXVsdCBpcyBgZmFsc2VgIHdoaWNoIHNob3dzIG5vIG1hcC5cbiAgLy8gKiBgZGV0YWlsc2AgLSBUaGUgY29udGFpbmVyIHRoYXQgc2hvdWxkIGJlIHBvcHVsYXRlZCB3aXRoIGRhdGEuIERlZmF1bHRzIHRvIGBmYWxzZWAgd2hpY2ggaWdub3JlcyB0aGUgc2V0dGluZy5cbiAgLy8gKiBgbG9jYXRpb25gIC0gTG9jYXRpb24gdG8gaW5pdGlhbGl6ZSB0aGUgbWFwIG9uLiBNaWdodCBiZSBhbiBhZGRyZXNzIGBzdHJpbmdgIG9yIGFuIGBhcnJheWAgd2l0aCBbbGF0aXR1ZGUsIGxvbmdpdHVkZV0gb3IgYSBgZ29vZ2xlLm1hcHMuTGF0TG5nYG9iamVjdC4gRGVmYXVsdCBpcyBgZmFsc2VgIHdoaWNoIHNob3dzIGEgYmxhbmsgbWFwLlxuICAvLyAqIGBib3VuZHNgIC0gV2hldGhlciB0byBzbmFwIGdlb2NvZGUgc2VhcmNoIHRvIG1hcCBib3VuZHMuIERlZmF1bHQ6IGB0cnVlYCBpZiBmYWxzZSBzZWFyY2ggZ2xvYmFsbHkuIEFsdGVybmF0aXZlbHkgcGFzcyBhIGN1c3RvbSBgTGF0TG5nQm91bmRzIG9iamVjdC5cbiAgLy8gKiBgYXV0b3NlbGVjdGAgLSBBdXRvbWF0aWNhbGx5IHNlbGVjdHMgdGhlIGhpZ2hsaWdodGVkIGl0ZW0gb3IgdGhlIGZpcnN0IGl0ZW0gZnJvbSB0aGUgc3VnZ2VzdGlvbnMgbGlzdCBvbiBFbnRlci5cbiAgLy8gKiBgZGV0YWlsc0F0dHJpYnV0ZWAgLSBUaGUgYXR0cmlidXRlJ3MgbmFtZSB0byB1c2UgYXMgYW4gaW5kaWNhdG9yLiBEZWZhdWx0OiBgXCJuYW1lXCJgXG4gIC8vICogYG1hcE9wdGlvbnNgIC0gT3B0aW9ucyB0byBwYXNzIHRvIHRoZSBgZ29vZ2xlLm1hcHMuTWFwYCBjb25zdHJ1Y3Rvci4gU2VlIHRoZSBmdWxsIGxpc3QgW2hlcmVdKGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vYXBpcy9tYXBzL2RvY3VtZW50YXRpb24vamF2YXNjcmlwdC9yZWZlcmVuY2UuaHRtbCNNYXBPcHRpb25zKS5cbiAgLy8gKiBgbWFwT3B0aW9ucy56b29tYCAtIFRoZSBpbml0YWwgem9vbSBsZXZlbC4gRGVmYXVsdDogYDE0YFxuICAvLyAqIGBtYXBPcHRpb25zLnNjcm9sbHdoZWVsYCAtIFdoZXRoZXIgdG8gZW5hYmxlIHRoZSBzY3JvbGx3aGVlbCB0byB6b29tIHRoZSBtYXAuIERlZmF1bHQ6IGBmYWxzZWBcbiAgLy8gKiBgbWFwT3B0aW9ucy5tYXBUeXBlSWRgIC0gVGhlIG1hcCB0eXBlLiBEZWZhdWx0OiBgXCJyb2FkbWFwXCJgXG4gIC8vICogYG1hcmtlck9wdGlvbnNgIC0gVGhlIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgYGdvb2dsZS5tYXBzLk1hcmtlcmAgY29uc3RydWN0b3IuIFNlZSB0aGUgZnVsbCBsaXN0IFtoZXJlXShodHRwOi8vY29kZS5nb29nbGUuY29tL2FwaXMvbWFwcy9kb2N1bWVudGF0aW9uL2phdmFzY3JpcHQvcmVmZXJlbmNlLmh0bWwjTWFya2VyT3B0aW9ucykuXG4gIC8vICogYG1hcmtlck9wdGlvbnMuZHJhZ2dhYmxlYCAtIElmIHRoZSBtYXJrZXIgaXMgZHJhZ2dhYmxlLiBEZWZhdWx0OiBgZmFsc2VgLiBTZXQgdG8gdHJ1ZSB0byBlbmFibGUgZHJhZ2dpbmcuXG4gIC8vICogYG1hcmtlck9wdGlvbnMuZGlzYWJsZWRgIC0gRG8gbm90IHNob3cgbWFya2VyLiBEZWZhdWx0OiBgZmFsc2VgLiBTZXQgdG8gdHJ1ZSB0byBkaXNhYmxlIG1hcmtlci5cbiAgLy8gKiBgbWF4Wm9vbWAgLSBUaGUgbWF4aW11bSB6b29tIGxldmVsIHRvbyB6b29tIGluIGFmdGVyIGEgZ2VvY29kaW5nIHJlc3BvbnNlLiBEZWZhdWx0OiBgMTZgXG4gIC8vICogYHR5cGVzYCAtIEFuIGFycmF5IGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgb2YgdGhlIHN1cHBvcnRlZCB0eXBlcyBmb3IgdGhlIHBsYWNlcyByZXF1ZXN0LiBEZWZhdWx0OiBgWydnZW9jb2RlJ11gIFNlZSB0aGUgZnVsbCBsaXN0IFtoZXJlXShodHRwOi8vY29kZS5nb29nbGUuY29tL2FwaXMvbWFwcy9kb2N1bWVudGF0aW9uL2phdmFzY3JpcHQvcGxhY2VzLmh0bWwjcGxhY2Vfc2VhcmNoX3JlcXVlc3RzKS5cblxuICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgYm91bmRzOiB0cnVlLFxuICAgIGNvdW50cnk6IG51bGwsXG4gICAgbWFwOiBmYWxzZSxcbiAgICBkZXRhaWxzOiBmYWxzZSxcbiAgICBkZXRhaWxzQXR0cmlidXRlOiBcIm5hbWVcIixcbiAgICBhdXRvc2VsZWN0OiB0cnVlLFxuICAgIGxvY2F0aW9uOiBmYWxzZSxcblxuICAgIG1hcE9wdGlvbnM6IHtcbiAgICAgIHpvb206IDE0LFxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlLFxuICAgICAgbWFwVHlwZUlkOiBcInJvYWRtYXBcIlxuICAgIH0sXG5cbiAgICBtYXJrZXJPcHRpb25zOiB7XG4gICAgICBkcmFnZ2FibGU6IGZhbHNlXG4gICAgfSxcblxuICAgIG1heFpvb206IDE2LFxuICAgIHR5cGVzOiBbJ2dlb2NvZGUnXSxcbiAgICBibHVyOiBmYWxzZVxuICB9O1xuXG4gIC8vIFNlZTogW0dlb2NvZGluZyBUeXBlc10oaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vbWFwcy9kb2N1bWVudGF0aW9uL2dlb2NvZGluZy8jVHlwZXMpXG4gIC8vIG9uIEdvb2dsZSBEZXZlbG9wZXJzLlxuICB2YXIgY29tcG9uZW50VHlwZXMgPSAoXCJzdHJlZXRfYWRkcmVzcyByb3V0ZSBpbnRlcnNlY3Rpb24gcG9saXRpY2FsIFwiICtcbiAgICBcImNvdW50cnkgYWRtaW5pc3RyYXRpdmVfYXJlYV9sZXZlbF8xIGFkbWluaXN0cmF0aXZlX2FyZWFfbGV2ZWxfMiBcIiArXG4gICAgXCJhZG1pbmlzdHJhdGl2ZV9hcmVhX2xldmVsXzMgY29sbG9xdWlhbF9hcmVhIGxvY2FsaXR5IHN1YmxvY2FsaXR5IFwiICtcbiAgICBcIm5laWdoYm9yaG9vZCBwcmVtaXNlIHN1YnByZW1pc2UgcG9zdGFsX2NvZGUgbmF0dXJhbF9mZWF0dXJlIGFpcnBvcnQgXCIgK1xuICAgIFwicGFyayBwb2ludF9vZl9pbnRlcmVzdCBwb3N0X2JveCBzdHJlZXRfbnVtYmVyIGZsb29yIHJvb20gXCIgK1xuICAgIFwibGF0IGxuZyB2aWV3cG9ydCBsb2NhdGlvbiBcIiArXG4gICAgXCJmb3JtYXR0ZWRfYWRkcmVzcyBsb2NhdGlvbl90eXBlIGJvdW5kc1wiKS5zcGxpdChcIiBcIik7XG5cbiAgLy8gU2VlOiBbUGxhY2VzIERldGFpbHMgUmVzcG9uc2VzXShodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9tYXBzL2RvY3VtZW50YXRpb24vamF2YXNjcmlwdC9wbGFjZXMjcGxhY2VfZGV0YWlsc19yZXNwb25zZXMpXG4gIC8vIG9uIEdvb2dsZSBEZXZlbG9wZXJzLlxuICB2YXIgcGxhY2VzRGV0YWlscyA9IChcImlkIHBsYWNlX2lkIHVybCB3ZWJzaXRlIHZpY2luaXR5IHJlZmVyZW5jZSBuYW1lIHJhdGluZyBcIiArXG4gICAgXCJpbnRlcm5hdGlvbmFsX3Bob25lX251bWJlciBpY29uIGZvcm1hdHRlZF9waG9uZV9udW1iZXJcIikuc3BsaXQoXCIgXCIpO1xuXG4gIC8vIFRoZSBhY3R1YWwgcGx1Z2luIGNvbnN0cnVjdG9yLlxuICBmdW5jdGlvbiBHZW9Db21wbGV0ZShpbnB1dCwgb3B0aW9ucykge1xuXG4gICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgICB0aGlzLiRpbnB1dCA9ICQoaW5wdXQpO1xuXG4gICAgdGhpcy5fZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgICB0aGlzLl9uYW1lID0gJ2dlb2NvbXBsZXRlJztcblxuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgLy8gSW5pdGlhbGl6ZSBhbGwgcGFydHMgb2YgdGhlIHBsdWdpbi5cbiAgJC5leHRlbmQoR2VvQ29tcGxldGUucHJvdG90eXBlLCB7XG4gICAgaW5pdDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuaW5pdE1hcCgpO1xuICAgICAgdGhpcy5pbml0TWFya2VyKCk7XG4gICAgICB0aGlzLmluaXRHZW9jb2RlcigpO1xuICAgICAgdGhpcy5pbml0RGV0YWlscygpO1xuICAgICAgdGhpcy5pbml0TG9jYXRpb24oKTtcbiAgICB9LFxuXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgbWFwIGJ1dCBvbmx5IGlmIHRoZSBvcHRpb24gYG1hcGAgd2FzIHNldC5cbiAgICAvLyBUaGlzIHdpbGwgY3JlYXRlIGEgYG1hcGAgd2l0aGluIHRoZSBnaXZlbiBjb250YWluZXJcbiAgICAvLyB1c2luZyB0aGUgcHJvdmlkZWQgYG1hcE9wdGlvbnNgIG9yIGxpbmsgdG8gdGhlIGV4aXN0aW5nIG1hcCBpbnN0YW5jZS5cbiAgICBpbml0TWFwOiBmdW5jdGlvbigpe1xuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMubWFwKXsgcmV0dXJuOyB9XG5cbiAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLm1hcC5zZXRDZW50ZXIgPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgdGhpcy5tYXAgPSB0aGlzLm9wdGlvbnMubWFwO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChcbiAgICAgICAgJCh0aGlzLm9wdGlvbnMubWFwKVswXSxcbiAgICAgICAgdGhpcy5vcHRpb25zLm1hcE9wdGlvbnNcbiAgICAgICk7XG5cbiAgICAgIC8vIGFkZCBjbGljayBldmVudCBsaXN0ZW5lciBvbiB0aGUgbWFwXG4gICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihcbiAgICAgICAgdGhpcy5tYXAsXG4gICAgICAgICdjbGljaycsXG4gICAgICAgICQucHJveHkodGhpcy5tYXBDbGlja2VkLCB0aGlzKVxuICAgICAgKTtcblxuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoXG4gICAgICAgIHRoaXMubWFwLFxuICAgICAgICAnem9vbV9jaGFuZ2VkJyxcbiAgICAgICAgJC5wcm94eSh0aGlzLm1hcFpvb21lZCwgdGhpcylcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8vIEFkZCBhIG1hcmtlciB3aXRoIHRoZSBwcm92aWRlZCBgbWFya2VyT3B0aW9uc2AgYnV0IG9ubHlcbiAgICAvLyBpZiB0aGUgb3B0aW9uIHdhcyBzZXQuIEFkZGl0aW9uYWxseSBpdCBsaXN0ZW5zIGZvciB0aGUgYGRyYWdlbmRgIGV2ZW50XG4gICAgLy8gdG8gbm90aWZ5IHRoZSBwbHVnaW4gYWJvdXQgY2hhbmdlcy5cbiAgICBpbml0TWFya2VyOiBmdW5jdGlvbigpe1xuICAgICAgaWYgKCF0aGlzLm1hcCl7IHJldHVybjsgfVxuICAgICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh0aGlzLm9wdGlvbnMubWFya2VyT3B0aW9ucywgeyBtYXA6IHRoaXMubWFwIH0pO1xuXG4gICAgICBpZiAob3B0aW9ucy5kaXNhYmxlZCl7IHJldHVybjsgfVxuXG4gICAgICB0aGlzLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIob3B0aW9ucyk7XG5cbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKFxuICAgICAgICB0aGlzLm1hcmtlcixcbiAgICAgICAgJ2RyYWdlbmQnLFxuICAgICAgICAkLnByb3h5KHRoaXMubWFya2VyRHJhZ2dlZCwgdGhpcylcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8vIEFzc29jaWF0ZSB0aGUgaW5wdXQgd2l0aCB0aGUgYXV0b2NvbXBsZXRlciBhbmQgY3JlYXRlIGEgZ2VvY29kZXJcbiAgICAvLyB0byBmYWxsIGJhY2sgd2hlbiB0aGUgYXV0b2NvbXBsZXRlciBkb2VzIG5vdCByZXR1cm4gYSB2YWx1ZS5cbiAgICBpbml0R2VvY29kZXI6IGZ1bmN0aW9uKCl7XG5cbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICB0eXBlczogdGhpcy5vcHRpb25zLnR5cGVzLFxuICAgICAgICBib3VuZHM6IHRoaXMub3B0aW9ucy5ib3VuZHMgPT09IHRydWUgPyBudWxsIDogdGhpcy5vcHRpb25zLmJvdW5kcyxcbiAgICAgICAgY29tcG9uZW50UmVzdHJpY3Rpb25zOiB0aGlzLm9wdGlvbnMuY29tcG9uZW50UmVzdHJpY3Rpb25zXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmNvdW50cnkpe1xuICAgICAgICBvcHRpb25zLmNvbXBvbmVudFJlc3RyaWN0aW9ucyA9IHtjb3VudHJ5OiB0aGlzLm9wdGlvbnMuY291bnRyeX07XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5BdXRvY29tcGxldGUoXG4gICAgICAgIHRoaXMuaW5wdXQsIG9wdGlvbnNcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcblxuICAgICAgLy8gQmluZCBhdXRvY29tcGxldGUgdG8gbWFwIGJvdW5kcyBidXQgb25seSBpZiB0aGVyZSBpcyBhIG1hcFxuICAgICAgLy8gYW5kIGBvcHRpb25zLmJpbmRUb01hcGAgaXMgc2V0IHRvIHRydWUuXG4gICAgICBpZiAodGhpcy5tYXAgJiYgdGhpcy5vcHRpb25zLmJvdW5kcyA9PT0gdHJ1ZSl7XG4gICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLmJpbmRUbygnYm91bmRzJywgdGhpcy5tYXApO1xuICAgICAgfVxuXG4gICAgICAvLyBXYXRjaCBgcGxhY2VfY2hhbmdlZGAgZXZlbnRzIG9uIHRoZSBhdXRvY29tcGxldGUgaW5wdXQgZmllbGQuXG4gICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihcbiAgICAgICAgdGhpcy5hdXRvY29tcGxldGUsXG4gICAgICAgICdwbGFjZV9jaGFuZ2VkJyxcbiAgICAgICAgJC5wcm94eSh0aGlzLnBsYWNlQ2hhbmdlZCwgdGhpcylcbiAgICAgICk7XG5cbiAgICAgIC8vIFByZXZlbnQgcGFyZW50IGZvcm0gZnJvbSBiZWluZyBzdWJtaXR0ZWQgaWYgdXNlciBoaXQgZW50ZXIuXG4gICAgICB0aGlzLiRpbnB1dC5rZXlwcmVzcyhmdW5jdGlvbihldmVudCl7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMyl7IHJldHVybiBmYWxzZTsgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiBmb3IgXCJnZW9jb2RlXCIgZXZlbnRzIGFuZCB0cmlnZ2VyIGZpbmQgYWN0aW9uLlxuICAgICAgdGhpcy4kaW5wdXQuYmluZChcImdlb2NvZGVcIiwgJC5wcm94eShmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmZpbmQoKTtcbiAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgLy8gVHJpZ2dlciBmaW5kIGFjdGlvbiB3aGVuIGlucHV0IGVsZW1lbnQgaXMgYmx1cmVkIG91dC5cbiAgICAgIC8vIChVc2VmdWxsIGZvciB0eXBpbmcgcGFydGlhbCBsb2NhdGlvbiBhbmQgdGFiaW5nIHRvIHRoZSBuZXh0IGZpZWxkXG4gICAgICAvLyBvciBjbGlja2luZyBzb21ld2hlcmUgZWxzZS4pXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmJsdXIgPT09IHRydWUpe1xuICAgICAgICB0aGlzLiRpbnB1dC5ibHVyKCQucHJveHkoZnVuY3Rpb24oKXtcbiAgICAgICAgICB0aGlzLmZpbmQoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBQcmVwYXJlIGEgZ2l2ZW4gRE9NIHN0cnVjdHVyZSB0byBiZSBwb3B1bGF0ZWQgd2hlbiB3ZSBnb3Qgc29tZSBkYXRhLlxuICAgIC8vIFRoaXMgd2lsbCBjeWNsZSB0aHJvdWdoIHRoZSBsaXN0IG9mIGNvbXBvbmVudCB0eXBlcyBhbmQgbWFwIHRoZVxuICAgIC8vIGNvcnJlc3BvbmRpbmcgZWxlbWVudHMuXG4gICAgaW5pdERldGFpbHM6IGZ1bmN0aW9uKCl7XG4gICAgICBpZiAoIXRoaXMub3B0aW9ucy5kZXRhaWxzKXsgcmV0dXJuOyB9XG5cbiAgICAgIHZhciAkZGV0YWlscyA9ICQodGhpcy5vcHRpb25zLmRldGFpbHMpLFxuICAgICAgICBhdHRyaWJ1dGUgPSB0aGlzLm9wdGlvbnMuZGV0YWlsc0F0dHJpYnV0ZSxcbiAgICAgICAgZGV0YWlscyA9IHt9O1xuXG4gICAgICBmdW5jdGlvbiBzZXREZXRhaWwodmFsdWUpe1xuICAgICAgICBkZXRhaWxzW3ZhbHVlXSA9ICRkZXRhaWxzLmZpbmQoXCJbXCIgKyAgYXR0cmlidXRlICsgXCI9XCIgKyB2YWx1ZSArIFwiXVwiKTtcbiAgICAgIH1cblxuICAgICAgJC5lYWNoKGNvbXBvbmVudFR5cGVzLCBmdW5jdGlvbihpbmRleCwga2V5KXtcbiAgICAgICAgc2V0RGV0YWlsKGtleSk7XG4gICAgICAgIHNldERldGFpbChrZXkgKyBcIl9zaG9ydFwiKTtcbiAgICAgIH0pO1xuXG4gICAgICAkLmVhY2gocGxhY2VzRGV0YWlscywgZnVuY3Rpb24oaW5kZXgsIGtleSl7XG4gICAgICAgIHNldERldGFpbChrZXkpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuJGRldGFpbHMgPSAkZGV0YWlscztcbiAgICAgIHRoaXMuZGV0YWlscyA9IGRldGFpbHM7XG4gICAgfSxcblxuICAgIC8vIFNldCB0aGUgaW5pdGlhbCBsb2NhdGlvbiBvZiB0aGUgcGx1Z2luIGlmIHRoZSBgbG9jYXRpb25gIG9wdGlvbnMgd2FzIHNldC5cbiAgICAvLyBUaGlzIG1ldGhvZCB3aWxsIGNhcmUgYWJvdXQgY29udmVydGluZyB0aGUgdmFsdWUgaW50byB0aGUgcmlnaHQgZm9ybWF0LlxuICAgIGluaXRMb2NhdGlvbjogZnVuY3Rpb24oKSB7XG5cbiAgICAgIHZhciBsb2NhdGlvbiA9IHRoaXMub3B0aW9ucy5sb2NhdGlvbiwgbGF0TG5nO1xuXG4gICAgICBpZiAoIWxvY2F0aW9uKSB7IHJldHVybjsgfVxuXG4gICAgICBpZiAodHlwZW9mIGxvY2F0aW9uID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRoaXMuZmluZChsb2NhdGlvbik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGxvY2F0aW9uIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgbGF0TG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvblswXSwgbG9jYXRpb25bMV0pO1xuICAgICAgfVxuXG4gICAgICBpZiAobG9jYXRpb24gaW5zdGFuY2VvZiBnb29nbGUubWFwcy5MYXRMbmcpe1xuICAgICAgICBsYXRMbmcgPSBsb2NhdGlvbjtcbiAgICAgIH1cblxuICAgICAgaWYgKGxhdExuZyl7XG4gICAgICAgIGlmICh0aGlzLm1hcCl7IHRoaXMubWFwLnNldENlbnRlcihsYXRMbmcpOyB9XG4gICAgICAgIGlmICh0aGlzLm1hcmtlcil7IHRoaXMubWFya2VyLnNldFBvc2l0aW9uKGxhdExuZyk7IH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gTG9vayB1cCBhIGdpdmVuIGFkZHJlc3MuIElmIG5vIGBhZGRyZXNzYCB3YXMgc3BlY2lmaWVkIGl0IHVzZXNcbiAgICAvLyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgaW5wdXQuXG4gICAgZmluZDogZnVuY3Rpb24oYWRkcmVzcyl7XG4gICAgICB0aGlzLmdlb2NvZGUoe1xuICAgICAgICBhZGRyZXNzOiBhZGRyZXNzIHx8IHRoaXMuJGlucHV0LnZhbCgpXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gUmVxdWVzdHMgZGV0YWlscyBhYm91dCBhIGdpdmVuIGxvY2F0aW9uLlxuICAgIC8vIEFkZGl0aW9uYWxseSBpdCB3aWxsIGJpYXMgdGhlIHJlcXVlc3RzIHRvIHRoZSBwcm92aWRlZCBib3VuZHMuXG4gICAgZ2VvY29kZTogZnVuY3Rpb24ocmVxdWVzdCl7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmJvdW5kcyAmJiAhcmVxdWVzdC5ib3VuZHMpe1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmJvdW5kcyA9PT0gdHJ1ZSl7XG4gICAgICAgICAgcmVxdWVzdC5ib3VuZHMgPSB0aGlzLm1hcCAmJiB0aGlzLm1hcC5nZXRCb3VuZHMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXF1ZXN0LmJvdW5kcyA9IHRoaXMub3B0aW9ucy5ib3VuZHM7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb3VudHJ5KXtcbiAgICAgICAgcmVxdWVzdC5yZWdpb24gPSB0aGlzLm9wdGlvbnMuY291bnRyeTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5nZW9jb2Rlci5nZW9jb2RlKHJlcXVlc3QsICQucHJveHkodGhpcy5oYW5kbGVHZW9jb2RlLCB0aGlzKSk7XG4gICAgfSxcblxuICAgIC8vIEdldCB0aGUgc2VsZWN0ZWQgcmVzdWx0LiBJZiBubyByZXN1bHQgaXMgc2VsZWN0ZWQgb24gdGhlIGxpc3QsIHRoZW4gZ2V0XG4gICAgLy8gdGhlIGZpcnN0IHJlc3VsdCBmcm9tIHRoZSBsaXN0LlxuICAgIHNlbGVjdEZpcnN0UmVzdWx0OiBmdW5jdGlvbigpIHtcbiAgICAgIC8vJChcIi5wYWMtY29udGFpbmVyXCIpLmhpZGUoKTtcblxuICAgICAgdmFyIHNlbGVjdGVkID0gJyc7XG4gICAgICAvLyBDaGVjayBpZiBhbnkgcmVzdWx0IGlzIHNlbGVjdGVkLlxuICAgICAgaWYgKCQoXCIucGFjLWl0ZW0tc2VsZWN0ZWRcIilbMF0pIHtcbiAgICAgICAgc2VsZWN0ZWQgPSAnLXNlbGVjdGVkJztcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRoZSBmaXJzdCBzdWdnZXN0aW9uJ3MgdGV4dC5cbiAgICAgIHZhciAkc3BhbjEgPSAkKFwiLnBhYy1jb250YWluZXIgLnBhYy1pdGVtXCIgKyBzZWxlY3RlZCArIFwiOmZpcnN0IHNwYW46bnRoLWNoaWxkKDIpXCIpLnRleHQoKTtcbiAgICAgIHZhciAkc3BhbjIgPSAkKFwiLnBhYy1jb250YWluZXIgLnBhYy1pdGVtXCIgKyBzZWxlY3RlZCArIFwiOmZpcnN0IHNwYW46bnRoLWNoaWxkKDMpXCIpLnRleHQoKTtcblxuICAgICAgLy8gQWRkcyB0aGUgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiwgaWYgYXZhaWxhYmxlLlxuICAgICAgdmFyIGZpcnN0UmVzdWx0ID0gJHNwYW4xO1xuICAgICAgaWYgKCRzcGFuMikge1xuICAgICAgICBmaXJzdFJlc3VsdCArPSBcIiAtIFwiICsgJHNwYW4yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLiRpbnB1dC52YWwoZmlyc3RSZXN1bHQpO1xuXG4gICAgICByZXR1cm4gZmlyc3RSZXN1bHQ7XG4gICAgfSxcblxuICAgIC8vIEhhbmRsZXMgdGhlIGdlb2NvZGUgcmVzcG9uc2UuIElmIG1vcmUgdGhhbiBvbmUgcmVzdWx0cyB3YXMgZm91bmRcbiAgICAvLyBpdCB0cmlnZ2VycyB0aGUgXCJnZW9jb2RlOm11bHRpcGxlXCIgZXZlbnRzLiBJZiB0aGVyZSB3YXMgYW4gZXJyb3JcbiAgICAvLyB0aGUgXCJnZW9jb2RlOmVycm9yXCIgZXZlbnQgaXMgZmlyZWQuXG4gICAgaGFuZGxlR2VvY29kZTogZnVuY3Rpb24ocmVzdWx0cywgc3RhdHVzKXtcbiAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSByZXN1bHRzWzBdO1xuICAgICAgICB0aGlzLiRpbnB1dC52YWwocmVzdWx0LmZvcm1hdHRlZF9hZGRyZXNzKTtcbiAgICAgICAgdGhpcy51cGRhdGUocmVzdWx0KTtcblxuICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAxKXtcbiAgICAgICAgICB0aGlzLnRyaWdnZXIoXCJnZW9jb2RlOm11bHRpcGxlXCIsIHJlc3VsdHMpO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcImdlb2NvZGU6ZXJyb3JcIiwgc3RhdHVzKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gVHJpZ2dlcnMgYSBnaXZlbiBgZXZlbnRgIHdpdGggb3B0aW9uYWwgYGFyZ3VtZW50c2Agb24gdGhlIGlucHV0LlxuICAgIHRyaWdnZXI6IGZ1bmN0aW9uKGV2ZW50LCBhcmd1bWVudCl7XG4gICAgICB0aGlzLiRpbnB1dC50cmlnZ2VyKGV2ZW50LCBbYXJndW1lbnRdKTtcbiAgICB9LFxuXG4gICAgLy8gU2V0IHRoZSBtYXAgdG8gYSBuZXcgY2VudGVyIGJ5IHBhc3NpbmcgYSBgZ2VvbWV0cnlgLlxuICAgIC8vIElmIHRoZSBnZW9tZXRyeSBoYXMgYSB2aWV3cG9ydCwgdGhlIG1hcCB6b29tcyBvdXQgdG8gZml0IHRoZSBib3VuZHMuXG4gICAgLy8gQWRkaXRpb25hbGx5IGl0IHVwZGF0ZXMgdGhlIG1hcmtlciBwb3NpdGlvbi5cbiAgICBjZW50ZXI6IGZ1bmN0aW9uKGdlb21ldHJ5KXtcblxuICAgICAgaWYgKGdlb21ldHJ5LnZpZXdwb3J0KXtcbiAgICAgICAgdGhpcy5tYXAuZml0Qm91bmRzKGdlb21ldHJ5LnZpZXdwb3J0KTtcbiAgICAgICAgaWYgKHRoaXMubWFwLmdldFpvb20oKSA+IHRoaXMub3B0aW9ucy5tYXhab29tKXtcbiAgICAgICAgICB0aGlzLm1hcC5zZXRab29tKHRoaXMub3B0aW9ucy5tYXhab29tKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tYXAuc2V0Wm9vbSh0aGlzLm9wdGlvbnMubWF4Wm9vbSk7XG4gICAgICAgIHRoaXMubWFwLnNldENlbnRlcihnZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm1hcmtlcil7XG4gICAgICAgIHRoaXMubWFya2VyLnNldFBvc2l0aW9uKGdlb21ldHJ5LmxvY2F0aW9uKTtcbiAgICAgICAgdGhpcy5tYXJrZXIuc2V0QW5pbWF0aW9uKHRoaXMub3B0aW9ucy5tYXJrZXJPcHRpb25zLmFuaW1hdGlvbik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSB0aGUgZWxlbWVudHMgYmFzZWQgb24gYSBzaW5nbGUgcGxhY2VzIG9yIGdlb29jb2RpbmcgcmVzcG9uc2VcbiAgICAvLyBhbmQgdHJpZ2dlciB0aGUgXCJnZW9jb2RlOnJlc3VsdFwiIGV2ZW50IG9uIHRoZSBpbnB1dC5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKHJlc3VsdCl7XG5cbiAgICAgIGlmICh0aGlzLm1hcCl7XG4gICAgICAgIHRoaXMuY2VudGVyKHJlc3VsdC5nZW9tZXRyeSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLiRkZXRhaWxzKXtcbiAgICAgICAgdGhpcy5maWxsRGV0YWlscyhyZXN1bHQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnRyaWdnZXIoXCJnZW9jb2RlOnJlc3VsdFwiLCByZXN1bHQpO1xuICAgIH0sXG5cbiAgICAvLyBQb3B1bGF0ZSB0aGUgcHJvdmlkZWQgZWxlbWVudHMgd2l0aCBuZXcgYHJlc3VsdGAgZGF0YS5cbiAgICAvLyBUaGlzIHdpbGwgbG9va3VwIGFsbCBlbGVtZW50cyB0aGF0IGhhcyBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgZ2l2ZW5cbiAgICAvLyBjb21wb25lbnQgdHlwZS5cbiAgICBmaWxsRGV0YWlsczogZnVuY3Rpb24ocmVzdWx0KXtcblxuICAgICAgdmFyIGRhdGEgPSB7fSxcbiAgICAgICAgZ2VvbWV0cnkgPSByZXN1bHQuZ2VvbWV0cnksXG4gICAgICAgIHZpZXdwb3J0ID0gZ2VvbWV0cnkudmlld3BvcnQsXG4gICAgICAgIGJvdW5kcyA9IGdlb21ldHJ5LmJvdW5kcztcblxuICAgICAgLy8gQ3JlYXRlIGEgc2ltcGxpZmllZCB2ZXJzaW9uIG9mIHRoZSBhZGRyZXNzIGNvbXBvbmVudHMuXG4gICAgICAkLmVhY2gocmVzdWx0LmFkZHJlc3NfY29tcG9uZW50cywgZnVuY3Rpb24oaW5kZXgsIG9iamVjdCl7XG4gICAgICAgIHZhciBuYW1lID0gb2JqZWN0LnR5cGVzWzBdO1xuXG4gICAgICAgICQuZWFjaChvYmplY3QudHlwZXMsIGZ1bmN0aW9uKGluZGV4LCBuYW1lKXtcbiAgICAgICAgICBkYXRhW25hbWVdID0gb2JqZWN0LmxvbmdfbmFtZTtcbiAgICAgICAgICBkYXRhW25hbWUgKyBcIl9zaG9ydFwiXSA9IG9iamVjdC5zaG9ydF9uYW1lO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgcHJvcGVydGllcyBvZiB0aGUgcGxhY2VzIGRldGFpbHMuXG4gICAgICAkLmVhY2gocGxhY2VzRGV0YWlscywgZnVuY3Rpb24oaW5kZXgsIGtleSl7XG4gICAgICAgIGRhdGFba2V5XSA9IHJlc3VsdFtrZXldO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBpbmZvcyBhYm91dCB0aGUgYWRkcmVzcyBhbmQgZ2VvbWV0cnkuXG4gICAgICAkLmV4dGVuZChkYXRhLCB7XG4gICAgICAgIGZvcm1hdHRlZF9hZGRyZXNzOiByZXN1bHQuZm9ybWF0dGVkX2FkZHJlc3MsXG4gICAgICAgIGxvY2F0aW9uX3R5cGU6IGdlb21ldHJ5LmxvY2F0aW9uX3R5cGUgfHwgXCJQTEFDRVNcIixcbiAgICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0LFxuICAgICAgICBib3VuZHM6IGJvdW5kcyxcbiAgICAgICAgbG9jYXRpb246IGdlb21ldHJ5LmxvY2F0aW9uLFxuICAgICAgICBsYXQ6IGdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpLFxuICAgICAgICBsbmc6IGdlb21ldHJ5LmxvY2F0aW9uLmxuZygpXG4gICAgICB9KTtcblxuICAgICAgLy8gU2V0IHRoZSB2YWx1ZXMgZm9yIGFsbCBkZXRhaWxzLlxuICAgICAgJC5lYWNoKHRoaXMuZGV0YWlscywgJC5wcm94eShmdW5jdGlvbihrZXksICRkZXRhaWwpe1xuICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07XG4gICAgICAgIHRoaXMuc2V0RGV0YWlsKCRkZXRhaWwsIHZhbHVlKTtcbiAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB9LFxuXG4gICAgLy8gQXNzaWduIGEgZ2l2ZW4gYHZhbHVlYCB0byBhIHNpbmdsZSBgJGVsZW1lbnRgLlxuICAgIC8vIElmIHRoZSBlbGVtZW50IGlzIGFuIGlucHV0LCB0aGUgdmFsdWUgaXMgc2V0LCBvdGhlcndpc2UgaXQgdXBkYXRlc1xuICAgIC8vIHRoZSB0ZXh0IGNvbnRlbnQuXG4gICAgc2V0RGV0YWlsOiBmdW5jdGlvbigkZWxlbWVudCwgdmFsdWUpe1xuXG4gICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgIHZhbHVlID0gXCJcIjtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlLnRvVXJsVmFsdWUgPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1VybFZhbHVlKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICgkZWxlbWVudC5pcyhcIjppbnB1dFwiKSl7XG4gICAgICAgICRlbGVtZW50LnZhbCh2YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkZWxlbWVudC50ZXh0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gRmlyZSB0aGUgXCJnZW9jb2RlOmRyYWdnZWRcIiBldmVudCBhbmQgcGFzcyB0aGUgbmV3IHBvc2l0aW9uLlxuICAgIG1hcmtlckRyYWdnZWQ6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgIHRoaXMudHJpZ2dlcihcImdlb2NvZGU6ZHJhZ2dlZFwiLCBldmVudC5sYXRMbmcpO1xuICAgIH0sXG5cbiAgICBtYXBDbGlja2VkOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJnZW9jb2RlOmNsaWNrXCIsIGV2ZW50LmxhdExuZyk7XG4gICAgfSxcblxuICAgIG1hcFpvb21lZDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihcImdlb2NvZGU6em9vbVwiLCB0aGlzLm1hcC5nZXRab29tKCkpO1xuICAgIH0sXG5cbiAgICAvLyBSZXN0b3JlIHRoZSBvbGQgcG9zaXRpb24gb2YgdGhlIG1hcmtlciB0byB0aGUgbGFzdCBub3cgbG9jYXRpb24uXG4gICAgcmVzZXRNYXJrZXI6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLm1hcmtlci5zZXRQb3NpdGlvbih0aGlzLmRhdGEubG9jYXRpb24pO1xuICAgICAgdGhpcy5zZXREZXRhaWwodGhpcy5kZXRhaWxzLmxhdCwgdGhpcy5kYXRhLmxvY2F0aW9uLmxhdCgpKTtcbiAgICAgIHRoaXMuc2V0RGV0YWlsKHRoaXMuZGV0YWlscy5sbmcsIHRoaXMuZGF0YS5sb2NhdGlvbi5sbmcoKSk7XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSB0aGUgcGx1Z2luIGFmdGVyIHRoZSB1c2VyIGhhcyBzZWxlY3RlZCBhbiBhdXRvY29tcGxldGUgZW50cnkuXG4gICAgLy8gSWYgdGhlIHBsYWNlIGhhcyBubyBnZW9tZXRyeSBpdCBwYXNzZXMgaXQgdG8gdGhlIGdlb2NvZGVyLlxuICAgIHBsYWNlQ2hhbmdlZDogZnVuY3Rpb24oKXtcbiAgICAgIHZhciBwbGFjZSA9IHRoaXMuYXV0b2NvbXBsZXRlLmdldFBsYWNlKCk7XG5cbiAgICAgIGlmICghcGxhY2UgfHwgIXBsYWNlLmdlb21ldHJ5KXtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvc2VsZWN0KSB7XG4gICAgICAgICAgLy8gQXV0b21hdGljYWxseSBzZWxlY3RzIHRoZSBoaWdobGlnaHRlZCBpdGVtIG9yIHRoZSBmaXJzdCBpdGVtIGZyb20gdGhlXG4gICAgICAgICAgLy8gc3VnZ2VzdGlvbnMgbGlzdC5cbiAgICAgICAgICB2YXIgYXV0b1NlbGVjdGlvbiA9IHRoaXMuc2VsZWN0Rmlyc3RSZXN1bHQoKTtcbiAgICAgICAgICB0aGlzLmZpbmQoYXV0b1NlbGVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzZSB0aGUgaW5wdXQgdGV4dCBpZiBpdCBhbHJlYWR5IGdpdmVzIGdlb21ldHJ5LlxuICAgICAgICB0aGlzLnVwZGF0ZShwbGFjZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyBBIHBsdWdpbiB3cmFwcGVyIGFyb3VuZCB0aGUgY29uc3RydWN0b3IuXG4gIC8vIFBhc3MgYG9wdGlvbnNgIHdpdGggYWxsIHNldHRpbmdzIHRoYXQgYXJlIGRpZmZlcmVudCBmcm9tIHRoZSBkZWZhdWx0LlxuICAvLyBUaGUgYXR0cmlidXRlIGlzIHVzZWQgdG8gcHJldmVudCBtdWx0aXBsZSBpbnN0YW50aWF0aW9ucyBvZiB0aGUgcGx1Z2luLlxuICAkLmZuLmdlb2NvbXBsZXRlID0gZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgdmFyIGF0dHJpYnV0ZSA9ICdwbHVnaW5fZ2VvY29tcGxldGUnO1xuXG4gICAgLy8gSWYgeW91IGNhbGwgYC5nZW9jb21wbGV0ZSgpYCB3aXRoIGEgc3RyaW5nIGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXJcbiAgICAvLyBpdCByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IG9yIGNhbGxzIHRoZSBtZXRob2Qgd2l0aCB0aGVcbiAgICAvLyBmb2xsb3dpbmcgYXJndW1lbnRzLlxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PSBcInN0cmluZ1wiKXtcblxuICAgICAgdmFyIGluc3RhbmNlID0gJCh0aGlzKS5kYXRhKGF0dHJpYnV0ZSkgfHwgJCh0aGlzKS5nZW9jb21wbGV0ZSgpLmRhdGEoYXR0cmlidXRlKSxcbiAgICAgICAgcHJvcCA9IGluc3RhbmNlW29wdGlvbnNdO1xuXG4gICAgICBpZiAodHlwZW9mIHByb3AgPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgcHJvcC5hcHBseShpbnN0YW5jZSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgICAgIHJldHVybiAkKHRoaXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMil7XG4gICAgICAgICAgcHJvcCA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJvcDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gUHJldmVudCBhZ2FpbnN0IG11bHRpcGxlIGluc3RhbnRpYXRpb25zLlxuICAgICAgICB2YXIgaW5zdGFuY2UgPSAkLmRhdGEodGhpcywgYXR0cmlidXRlKTtcbiAgICAgICAgaWYgKCFpbnN0YW5jZSkge1xuICAgICAgICAgIGluc3RhbmNlID0gbmV3IEdlb0NvbXBsZXRlKCB0aGlzLCBvcHRpb25zICk7XG4gICAgICAgICAgJC5kYXRhKHRoaXMsIGF0dHJpYnV0ZSwgaW5zdGFuY2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==